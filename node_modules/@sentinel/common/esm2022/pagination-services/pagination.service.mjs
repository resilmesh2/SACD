import { Inject, Injectable, Optional } from '@angular/core';
import { distinctUntilChanged, shareReplay } from 'rxjs/operators';
import { INIT_PAGINATION_EVENT_BASE_TOKEN, PAGINATION_TYPE_TOKEN } from './pagination-token';
import equal from 'fast-deep-equal/es6';
import { CursorRequestedPaginationManager, isOffsetEvent, OffsetPaginationEvent, OffsetRequestedPaginationManager, isCursorEvent, CursorPaginationEvent, } from '@sentinel/common/pagination';
import * as i0 from "@angular/core";
import * as i1 from "./pagination-base-init";
export class PaginationService {
    constructor(initPaginationBase, paginationType) {
        this.initPaginationBase = initPaginationBase;
        this.paginationType = paginationType;
        if (!paginationType) {
            this.paginationType = 'cursor';
        }
        this.INIT_PAGINATION = createInitPagination(this.paginationType ?? 'cursor', this.initPaginationBase);
        this.paginationManager = createPaginationManager(this.INIT_PAGINATION.size, this.INIT_PAGINATION, this.paginationType ?? 'cursor');
        this.pagination$ = this.paginationManager.pagination$.asObservable().pipe(distinctUntilChanged((prev, curr) => equal(prev, curr)), shareReplay({ refCount: true }));
    }
    get() {
        return this.paginationManager.pagination$.getValue();
    }
    update(pagination) {
        this.paginationManager.update(pagination);
    }
    resetPosition() {
        this.paginationManager.resetPosition();
    }
    resetSize() {
        this.paginationManager.resetSize();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.0", ngImport: i0, type: PaginationService, deps: [{ token: INIT_PAGINATION_EVENT_BASE_TOKEN, optional: true }, { token: PAGINATION_TYPE_TOKEN, optional: true }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.0.0", ngImport: i0, type: PaginationService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.0", ngImport: i0, type: PaginationService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [{ type: i1.PaginationBaseInit, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [INIT_PAGINATION_EVENT_BASE_TOKEN]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [PAGINATION_TYPE_TOKEN]
                }] }] });
export function createInitPagination(paginationType, initPaginationBase) {
    const paginationBase = initPaginationBase ?? { size: 10, sort: undefined, sortDir: undefined };
    if (paginationType === 'offset') {
        return new OffsetPaginationEvent(0, paginationBase.size, paginationBase.sort, paginationBase.sortDir);
    }
    else if (paginationType === 'cursor') {
        return new CursorPaginationEvent(null, paginationBase.size, paginationBase.sort, paginationBase.sortDir);
    }
    else {
        throw new Error(`PaginationType does not match supported values 'offset' and 'cursor'`);
    }
}
export function createPaginationManager(initSize, initPagination, paginationType) {
    if (paginationType === 'offset' && isOffsetEvent(initPagination)) {
        return new OffsetRequestedPaginationManager(initSize, initPagination);
    }
    else if (paginationType === 'cursor' && isCursorEvent(initPagination)) {
        return new CursorRequestedPaginationManager(initSize, initPagination);
    }
    else {
        throw new TypeError('Incompatible pagination type and initial pagination');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc2VudGluZWwtY29tbW9uL3BhZ2luYXRpb24tc2VydmljZXMvc3JjL3BhZ2luYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFN0QsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR25FLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTdGLE9BQU8sS0FBSyxNQUFNLHFCQUFxQixDQUFDO0FBQ3hDLE9BQU8sRUFDTCxnQ0FBZ0MsRUFFaEMsYUFBYSxFQUNiLHFCQUFxQixFQUNyQixnQ0FBZ0MsRUFFaEMsYUFBYSxFQUNiLHFCQUFxQixHQUN0QixNQUFNLDZCQUE2QixDQUFDOzs7QUFHckMsTUFBTSxPQUFPLGlCQUFpQjtJQUs1QixZQUMyRSxrQkFBdUMsRUFDbEQsY0FBK0I7UUFEcEIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFxQjtRQUNsRCxtQkFBYyxHQUFkLGNBQWMsQ0FBaUI7UUFFN0YsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxjQUFjLEdBQUcsUUFBUSxDQUFDO1FBQ2pDLENBQUM7UUFDRCxJQUFJLENBQUMsZUFBZSxHQUFHLG9CQUFvQixDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksUUFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3RHLElBQUksQ0FBQyxpQkFBaUIsR0FBRyx1QkFBdUIsQ0FDOUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQ3pCLElBQUksQ0FBQyxlQUFlLEVBQ3BCLElBQUksQ0FBQyxjQUFjLElBQUksUUFBUSxDQUNoQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FDdkUsb0JBQW9CLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLEVBQ3ZELFdBQVcsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUNoQyxDQUFDO0lBQ0osQ0FBQztJQUVELEdBQUc7UUFDRCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDdkQsQ0FBQztJQUVELE1BQU0sQ0FBQyxVQUE0QjtRQUNqQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxhQUFhO1FBQ1gsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFFRCxTQUFTO1FBQ1AsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JDLENBQUM7OEdBdENVLGlCQUFpQixrQkFNTixnQ0FBZ0MsNkJBQ2hDLHFCQUFxQjtrSEFQaEMsaUJBQWlCOzsyRkFBakIsaUJBQWlCO2tCQUQ3QixVQUFVOzswQkFPTixRQUFROzswQkFBSSxNQUFNOzJCQUFDLGdDQUFnQzs7MEJBQ25ELFFBQVE7OzBCQUFJLE1BQU07MkJBQUMscUJBQXFCOztBQWtDN0MsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxjQUE4QixFQUM5QixrQkFBbUM7SUFFbkMsTUFBTSxjQUFjLEdBQW1CLGtCQUFrQixJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsQ0FBQztJQUMvRyxJQUFJLGNBQWMsS0FBSyxRQUFRLEVBQUUsQ0FBQztRQUNoQyxPQUFPLElBQUkscUJBQXFCLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEcsQ0FBQztTQUFNLElBQUksY0FBYyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ3ZDLE9BQU8sSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMzRyxDQUFDO1NBQU0sQ0FBQztRQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsc0VBQXNFLENBQUMsQ0FBQztJQUMxRixDQUFDO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSx1QkFBdUIsQ0FDckMsUUFBZ0IsRUFDaEIsY0FBZ0MsRUFDaEMsY0FBOEI7SUFFOUIsSUFBSSxjQUFjLEtBQUssUUFBUSxJQUFJLGFBQWEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1FBQ2pFLE9BQU8sSUFBSSxnQ0FBZ0MsQ0FBQyxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDeEUsQ0FBQztTQUFNLElBQUksY0FBYyxLQUFLLFFBQVEsSUFBSSxhQUFhLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztRQUN4RSxPQUFPLElBQUksZ0NBQWdDLENBQUMsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7U0FBTSxDQUFDO1FBQ04sTUFBTSxJQUFJLFNBQVMsQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO0lBQzdFLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGlzdGluY3RVbnRpbENoYW5nZWQsIHNoYXJlUmVwbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUGFnaW5hdGlvbkJhc2UgfSBmcm9tICcuL3BhZ2luYXRpb24tYmFzZSc7XG5pbXBvcnQgeyBQYWdpbmF0aW9uQmFzZUluaXQgfSBmcm9tICcuL3BhZ2luYXRpb24tYmFzZS1pbml0JztcbmltcG9ydCB7IElOSVRfUEFHSU5BVElPTl9FVkVOVF9CQVNFX1RPS0VOLCBQQUdJTkFUSU9OX1RZUEVfVE9LRU4gfSBmcm9tICcuL3BhZ2luYXRpb24tdG9rZW4nO1xuaW1wb3J0IHsgUGFnaW5hdGlvblR5cGUgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCBlcXVhbCBmcm9tICdmYXN0LWRlZXAtZXF1YWwvZXM2JztcbmltcG9ydCB7XG4gIEN1cnNvclJlcXVlc3RlZFBhZ2luYXRpb25NYW5hZ2VyLFxuICBJUGFnaW5hdGlvbkV2ZW50LFxuICBpc09mZnNldEV2ZW50LFxuICBPZmZzZXRQYWdpbmF0aW9uRXZlbnQsXG4gIE9mZnNldFJlcXVlc3RlZFBhZ2luYXRpb25NYW5hZ2VyLFxuICBSZXF1ZXN0ZWRQYWdpbmF0aW9uTWFuYWdlcixcbiAgaXNDdXJzb3JFdmVudCxcbiAgQ3Vyc29yUGFnaW5hdGlvbkV2ZW50LFxufSBmcm9tICdAc2VudGluZWwvY29tbW9uL3BhZ2luYXRpb24nO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUGFnaW5hdGlvblNlcnZpY2Uge1xuICByZWFkb25seSBJTklUX1BBR0lOQVRJT046IElQYWdpbmF0aW9uRXZlbnQ7XG4gIHByb3RlY3RlZCBwYWdpbmF0aW9uTWFuYWdlcjogUmVxdWVzdGVkUGFnaW5hdGlvbk1hbmFnZXI7XG4gIHBhZ2luYXRpb24kOiBPYnNlcnZhYmxlPElQYWdpbmF0aW9uRXZlbnQ+O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoSU5JVF9QQUdJTkFUSU9OX0VWRU5UX0JBU0VfVE9LRU4pIHByb3RlY3RlZCByZWFkb25seSBpbml0UGFnaW5hdGlvbkJhc2U/OiBQYWdpbmF0aW9uQmFzZUluaXQsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChQQUdJTkFUSU9OX1RZUEVfVE9LRU4pIHByb3RlY3RlZCByZWFkb25seSBwYWdpbmF0aW9uVHlwZT86IFBhZ2luYXRpb25UeXBlLFxuICApIHtcbiAgICBpZiAoIXBhZ2luYXRpb25UeXBlKSB7XG4gICAgICB0aGlzLnBhZ2luYXRpb25UeXBlID0gJ2N1cnNvcic7XG4gICAgfVxuICAgIHRoaXMuSU5JVF9QQUdJTkFUSU9OID0gY3JlYXRlSW5pdFBhZ2luYXRpb24odGhpcy5wYWdpbmF0aW9uVHlwZSA/PyAnY3Vyc29yJywgdGhpcy5pbml0UGFnaW5hdGlvbkJhc2UpO1xuICAgIHRoaXMucGFnaW5hdGlvbk1hbmFnZXIgPSBjcmVhdGVQYWdpbmF0aW9uTWFuYWdlcihcbiAgICAgIHRoaXMuSU5JVF9QQUdJTkFUSU9OLnNpemUsXG4gICAgICB0aGlzLklOSVRfUEFHSU5BVElPTixcbiAgICAgIHRoaXMucGFnaW5hdGlvblR5cGUgPz8gJ2N1cnNvcicsXG4gICAgKTtcbiAgICB0aGlzLnBhZ2luYXRpb24kID0gdGhpcy5wYWdpbmF0aW9uTWFuYWdlci5wYWdpbmF0aW9uJC5hc09ic2VydmFibGUoKS5waXBlKFxuICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKHByZXYsIGN1cnIpID0+IGVxdWFsKHByZXYsIGN1cnIpKSxcbiAgICAgIHNoYXJlUmVwbGF5KHsgcmVmQ291bnQ6IHRydWUgfSksXG4gICAgKTtcbiAgfVxuXG4gIGdldCgpOiBJUGFnaW5hdGlvbkV2ZW50IHtcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uTWFuYWdlci5wYWdpbmF0aW9uJC5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgdXBkYXRlKHBhZ2luYXRpb246IElQYWdpbmF0aW9uRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLnBhZ2luYXRpb25NYW5hZ2VyLnVwZGF0ZShwYWdpbmF0aW9uKTtcbiAgfVxuXG4gIHJlc2V0UG9zaXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy5wYWdpbmF0aW9uTWFuYWdlci5yZXNldFBvc2l0aW9uKCk7XG4gIH1cblxuICByZXNldFNpemUoKTogdm9pZCB7XG4gICAgdGhpcy5wYWdpbmF0aW9uTWFuYWdlci5yZXNldFNpemUoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSW5pdFBhZ2luYXRpb24oXG4gIHBhZ2luYXRpb25UeXBlOiBQYWdpbmF0aW9uVHlwZSxcbiAgaW5pdFBhZ2luYXRpb25CYXNlPzogUGFnaW5hdGlvbkJhc2UsXG4pOiBJUGFnaW5hdGlvbkV2ZW50IHtcbiAgY29uc3QgcGFnaW5hdGlvbkJhc2U6IFBhZ2luYXRpb25CYXNlID0gaW5pdFBhZ2luYXRpb25CYXNlID8/IHsgc2l6ZTogMTAsIHNvcnQ6IHVuZGVmaW5lZCwgc29ydERpcjogdW5kZWZpbmVkIH07XG4gIGlmIChwYWdpbmF0aW9uVHlwZSA9PT0gJ29mZnNldCcpIHtcbiAgICByZXR1cm4gbmV3IE9mZnNldFBhZ2luYXRpb25FdmVudCgwLCBwYWdpbmF0aW9uQmFzZS5zaXplLCBwYWdpbmF0aW9uQmFzZS5zb3J0LCBwYWdpbmF0aW9uQmFzZS5zb3J0RGlyKTtcbiAgfSBlbHNlIGlmIChwYWdpbmF0aW9uVHlwZSA9PT0gJ2N1cnNvcicpIHtcbiAgICByZXR1cm4gbmV3IEN1cnNvclBhZ2luYXRpb25FdmVudChudWxsLCBwYWdpbmF0aW9uQmFzZS5zaXplLCBwYWdpbmF0aW9uQmFzZS5zb3J0LCBwYWdpbmF0aW9uQmFzZS5zb3J0RGlyKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFBhZ2luYXRpb25UeXBlIGRvZXMgbm90IG1hdGNoIHN1cHBvcnRlZCB2YWx1ZXMgJ29mZnNldCcgYW5kICdjdXJzb3InYCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBhZ2luYXRpb25NYW5hZ2VyKFxuICBpbml0U2l6ZTogbnVtYmVyLFxuICBpbml0UGFnaW5hdGlvbjogSVBhZ2luYXRpb25FdmVudCxcbiAgcGFnaW5hdGlvblR5cGU6IFBhZ2luYXRpb25UeXBlLFxuKTogUmVxdWVzdGVkUGFnaW5hdGlvbk1hbmFnZXIge1xuICBpZiAocGFnaW5hdGlvblR5cGUgPT09ICdvZmZzZXQnICYmIGlzT2Zmc2V0RXZlbnQoaW5pdFBhZ2luYXRpb24pKSB7XG4gICAgcmV0dXJuIG5ldyBPZmZzZXRSZXF1ZXN0ZWRQYWdpbmF0aW9uTWFuYWdlcihpbml0U2l6ZSwgaW5pdFBhZ2luYXRpb24pO1xuICB9IGVsc2UgaWYgKHBhZ2luYXRpb25UeXBlID09PSAnY3Vyc29yJyAmJiBpc0N1cnNvckV2ZW50KGluaXRQYWdpbmF0aW9uKSkge1xuICAgIHJldHVybiBuZXcgQ3Vyc29yUmVxdWVzdGVkUGFnaW5hdGlvbk1hbmFnZXIoaW5pdFNpemUsIGluaXRQYWdpbmF0aW9uKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbmNvbXBhdGlibGUgcGFnaW5hdGlvbiB0eXBlIGFuZCBpbml0aWFsIHBhZ2luYXRpb24nKTtcbiAgfVxufVxuIl19