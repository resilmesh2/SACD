import { fromEvent, mergeWith, share, Subject } from 'rxjs';
import { distinctUntilChanged, filter, map, throttleTime } from 'rxjs/operators';
/**
 * Resize Event provider of all registered elements
 */
const RESIZE_EVENTS_SUBJECT = new Subject();
/**
 * Observable instance of RESIZE_EVENTS_SUBJECT
 * @see RESIZE_EVENTS_SUBJECT
 */
const RESIZE_EVENTS = RESIZE_EVENTS_SUBJECT.pipe(share());
/**
 * Html Elements' Resize Observer
 */
const RESIZE_OBSERVER = new ResizeObserver((entries) => {
    entries.forEach((entry) => RESIZE_EVENTS_SUBJECT.next(entry));
});
/**
 * Mutation Event provider of all registered elements
 */
const MUTATION_EVENTS_SUBJECT = new Subject();
/**
 * Observable instance of MUTATION_EVENTS_SUBJECT
 * @see MUTATION_EVENTS_SUBJECT
 */
const MUTATION_EVENTS = MUTATION_EVENTS_SUBJECT.pipe(share());
/**
 * Html Elements' Mutation Observer
 */
const MUTATION_OBSERVER = new MutationObserver((records) => {
    records.forEach((record) => MUTATION_EVENTS_SUBJECT.next(record));
});
/**
 * Cache observed elements and observables
 */
const OBSERVER_CACHE = new WeakMap();
/**
 * Creates and registers resize observer for a window instance
 * @param target Target Window Object
 */
function windowResizeEventProvider(target) {
    let cache = OBSERVER_CACHE.get(target);
    if (!cache) {
        cache = fromEvent(target, 'resize').pipe(map(() => {
            if (target instanceof Window) {
                return { width: target.innerWidth, height: target.innerHeight };
            }
            else {
                throw new Error('Error');
            }
        }), share());
        OBSERVER_CACHE.set(target, cache);
    }
    return cache;
}
/**
 * Creates and registers resize observer for an HTMLElement instance
 * @param target Target Window Object
 */
function domElementResizeEventProvider(target) {
    let cache = OBSERVER_CACHE.get(target);
    if (!cache) {
        RESIZE_OBSERVER.observe(target);
        MUTATION_OBSERVER.observe(target, { attributes: true, characterData: true, subtree: true, childList: true });
        cache = RESIZE_EVENTS.pipe(filter((e) => e.target === target), map((entry) => ({ width: entry.contentRect.width, height: entry.contentRect.height })), mergeWith(MUTATION_EVENTS.pipe(filter((record) => record.type !== 'attributes'), map(() => ({ width: target.offsetWidth, height: target.offsetHeight })))), distinctUntilChanged(({ width, height }, next) => width === next.width && height === next.height), share());
        OBSERVER_CACHE.set(target, cache);
    }
    return cache;
}
export class SentinelResizeObserver {
    /**
     * @param target Target to listen its resize events
     * @param throttleTime Time interval to throttle resize events
     * > The throttle time under 90ms will not work well because of performance prospects.
     * > It will fire much less event than expected.
     */
    constructor(target, throttleTime = 90) {
        this.target = target;
        this.throttleTime = throttleTime;
        /**
         * The buffer for the observables which are throttled by the same time
         */
        this.buffer = {};
        this.provider =
            target instanceof Window ? windowResizeEventProvider(target) : domElementResizeEventProvider(target);
    }
    /**
     * Base Resize Observable
     *
     * Fires on every resize event
     *
     */
    get resize() {
        return this.throttleBy(this.throttleTime);
    }
    /**
     * Returns throttled resize events by given time
     *
     * Set `time` argument to `0` if you want to catch all events
     *
     * @param time Time to throttle events
     */
    throttleBy(time) {
        if (time <= 0) {
            return this.provider;
        }
        if (!(time in this.buffer)) {
            this.buffer[time] = this.provider.pipe(throttleTime(time));
        }
        return this.buffer[time];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VudGluZWwtcmVzaXplLW9ic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc2VudGluZWwtY29tbW9uL3Jlc2l6ZS9zcmMvc2VudGluZWwtcmVzaXplLW9ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFjLEtBQUssRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDeEUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFzQmpGOztHQUVHO0FBQ0gsTUFBTSxxQkFBcUIsR0FBRyxJQUFJLE9BQU8sRUFBdUIsQ0FBQztBQUVqRTs7O0dBR0c7QUFDSCxNQUFNLGFBQWEsR0FBRyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUUxRDs7R0FFRztBQUNILE1BQU0sZUFBZSxHQUFHLElBQUksY0FBYyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7SUFDckQsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDaEUsQ0FBQyxDQUFDLENBQUM7QUFFSDs7R0FFRztBQUNILE1BQU0sdUJBQXVCLEdBQUcsSUFBSSxPQUFPLEVBQWtCLENBQUM7QUFFOUQ7OztHQUdHO0FBQ0gsTUFBTSxlQUFlLEdBQUcsdUJBQXVCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7QUFFOUQ7O0dBRUc7QUFDSCxNQUFNLGlCQUFpQixHQUFHLElBQUksZ0JBQWdCLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtJQUN6RCxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxJ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QUFFLENBQUM7UUFZOUQsSUFBSSxDQUFDLFFBQVE7WUFDWCxNQUFNLFlBQVksTUFBTSxDQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsNkJBQTZCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekcsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsSUFBSSxNQUFNO1FBQ1IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksVUFBVSxDQUFDLElBQVk7UUFDNUIsSUFBSSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDZCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDdkIsQ0FBQztRQUVELElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZnJvbUV2ZW50LCBtZXJnZVdpdGgsIE9ic2VydmFibGUsIHNoYXJlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBtYXAsIHRocm90dGxlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuLyoqXG4gKiBSZXNpemFibGUgVGFyZ2V0IFR5cGUgKEhUTUxFbGVtZW50IG9yIFdpbmRvdylcbiAqL1xuZXhwb3J0IHR5cGUgUmVzaXphYmxlVGFyZ2V0ID0gSFRNTEVsZW1lbnQgfCBXaW5kb3c7XG5cbi8qKlxuICogUmVzaXplIEV2ZW50XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVzaXplRXZlbnQge1xuICAvKipcbiAgICogd2lkdGggb2YgdGhlIHRhcmdldCBpbiBwaXhlbHNcbiAgICovXG4gIHdpZHRoOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIGhlaWdodCBvZiB0aGUgdGFyZ2V0IGluIHBpeGVsc1xuICAgKi9cbiAgaGVpZ2h0OiBudW1iZXI7XG59XG5cbi8qKlxuICogUmVzaXplIEV2ZW50IHByb3ZpZGVyIG9mIGFsbCByZWdpc3RlcmVkIGVsZW1lbnRzXG4gKi9cbmNvbnN0IFJFU0laRV9FVkVOVFNfU1VCSkVDVCA9IG5ldyBTdWJqZWN0PFJlc2l6ZU9ic2VydmVyRW50cnk+KCk7XG5cbi8qKlxuICogT2JzZXJ2YWJsZSBpbnN0YW5jZSBvZiBSRVNJWkVfRVZFTlRTX1NVQkpFQ1RcbiAqIEBzZWUgUkVTSVpFX0VWRU5UU19TVUJKRUNUXG4gKi9cbmNvbnN0IFJFU0laRV9FVkVOVFMgPSBSRVNJWkVfRVZFTlRTX1NVQkpFQ1QucGlwZShzaGFyZSgpKTtcblxuLyoqXG4gKiBIdG1sIEVsZW1lbnRzJyBSZXNpemUgT2JzZXJ2ZXJcbiAqL1xuY29uc3QgUkVTSVpFX09CU0VSVkVSID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzKSA9PiB7XG4gIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IFJFU0laRV9FVkVOVFNfU1VCSkVDVC5uZXh0KGVudHJ5KSk7XG59KTtcblxuLyoqXG4gKiBNdXRhdGlvbiBFdmVudCBwcm92aWRlciBvZiBhbGwgcmVnaXN0ZXJlZCBlbGVtZW50c1xuICovXG5jb25zdCBNVVRBVElPTl9FVkVOVFNfU1VCSkVDVCA9IG5ldyBTdWJqZWN0PE11dGF0aW9uUmVjb3JkPigpO1xuXG4vKipcbiAqIE9ic2VydmFibGUgaW5zdGFuY2Ugb2YgTVVUQVRJT05fRVZFTlRTX1NVQkpFQ1RcbiAqIEBzZWUgTVVUQVRJT05fRVZFTlRTX1NVQkpFQ1RcbiAqL1xuY29uc3QgTVVUQVRJT05fRVZFTlRTID0gTVVUQVRJT05fRVZFTlRTX1NVQkpFQ1QucGlwZShzaGFyZSgpKTtcblxuLyoqXG4gKiBIdG1sIEVsZW1lbnRzJyBNdXRhdGlvbiBPYnNlcnZlclxuICovXG5jb25zdCBNVVRBVElPTl9PQlNFUlZFUiA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChyZWNvcmRzKSA9PiB7XG4gIHJlY29yZHMuZm9yRWFjaCgocmVjb3JkKSA9PiBNVVRBVElPTl9FVkVOVFNfU1VCSkVDVC5uZXh0KHJlY29yZCkpO1xufSk7XG5cbi8qKlxuICogQ2FjaGUgb2JzZXJ2ZWQgZWxlbWVudHMgYW5kIG9ic2VydmFibGVzXG4gKi9cbmNvbnN0IE9CU0VSVkVSX0NBQ0hFID0gbmV3IFdlYWtNYXA8UmVzaXphYmxlVGFyZ2V0LCBPYnNlcnZhYmxlPFJlc2l6ZUV2ZW50Pj4oKTtcblxuLyoqXG4gKiBDcmVhdGVzIGFuZCByZWdpc3RlcnMgcmVzaXplIG9ic2VydmVyIGZvciBhIHdpbmRvdyBpbnN0YW5jZVxuICogQHBhcmFtIHRhcmdldCBUYXJnZXQgV2luZG93IE9iamVjdFxuICovXG5mdW5jdGlvbiB3aW5kb3dSZXNpemVFdmVudFByb3ZpZGVyKHRhcmdldDogV2luZG93KTogT2JzZXJ2YWJsZTxSZXNpemVFdmVudD4ge1xuICBsZXQgY2FjaGUgPSBPQlNFUlZFUl9DQUNIRS5nZXQodGFyZ2V0KTtcblxuICBpZiAoIWNhY2hlKSB7XG4gICAgY2FjaGUgPSBmcm9tRXZlbnQodGFyZ2V0LCAncmVzaXplJykucGlwZShcbiAgICAgIG1hcCgoKSA9PiB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBXaW5kb3cpIHtcbiAgICAgICAgICByZXR1cm4geyB3aWR0aDogdGFyZ2V0LmlubmVyV2lkdGgsIGhlaWdodDogdGFyZ2V0LmlubmVySGVpZ2h0IH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHNoYXJlKCksXG4gICAgKTtcbiAgICBPQlNFUlZFUl9DQUNIRS5zZXQodGFyZ2V0LCBjYWNoZSk7XG4gIH1cbiAgcmV0dXJuIGNhY2hlO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYW5kIHJlZ2lzdGVycyByZXNpemUgb2JzZXJ2ZXIgZm9yIGFuIEhUTUxFbGVtZW50IGluc3RhbmNlXG4gKiBAcGFyYW0gdGFyZ2V0IFRhcmdldCBXaW5kb3cgT2JqZWN0XG4gKi9cbmZ1bmN0aW9uIGRvbUVsZW1lbnRSZXNpemVFdmVudFByb3ZpZGVyKHRhcmdldDogSFRNTEVsZW1lbnQpOiBPYnNlcnZhYmxlPFJlc2l6ZUV2ZW50PiB7XG4gIGxldCBjYWNoZSA9IE9CU0VSVkVSX0NBQ0hFLmdldCh0YXJnZXQpO1xuXG4gIGlmICghY2FjaGUpIHtcbiAgICBSRVNJWkVfT0JTRVJWRVIub2JzZXJ2ZSh0YXJnZXQpO1xuICAgIE1VVEFUSU9OX09CU0VSVkVSLm9ic2VydmUodGFyZ2V0LCB7IGF0dHJpYnV0ZXM6IHRydWUsIGNoYXJhY3RlckRhdGE6IHRydWUsIHN1YnRyZWU6IHRydWUsIGNoaWxkTGlzdDogdHJ1ZSB9KTtcblxuICAgIGNhY2hlID0gUkVTSVpFX0VWRU5UUy5waXBlKFxuICAgICAgZmlsdGVyKChlKSA9PiBlLnRhcmdldCA9PT0gdGFyZ2V0KSxcbiAgICAgIG1hcCgoZW50cnkpID0+IDxSZXNpemVFdmVudD57IHdpZHRoOiBlbnRyeS5jb250ZW50UmVjdC53aWR0aCwgaGVpZ2h0OiBlbnRyeS5jb250ZW50UmVjdC5oZWlnaHQgfSksXG4gICAgICBtZXJnZVdpdGgoXG4gICAgICAgIE1VVEFUSU9OX0VWRU5UUy5waXBlKFxuICAgICAgICAgIGZpbHRlcigocmVjb3JkKSA9PiByZWNvcmQudHlwZSAhPT0gJ2F0dHJpYnV0ZXMnKSxcbiAgICAgICAgICBtYXAoKCkgPT4gPFJlc2l6ZUV2ZW50Pnsgd2lkdGg6IHRhcmdldC5vZmZzZXRXaWR0aCwgaGVpZ2h0OiB0YXJnZXQub2Zmc2V0SGVpZ2h0IH0pLFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCh7IHdpZHRoLCBoZWlnaHQgfSwgbmV4dCkgPT4gd2lkdGggPT09IG5leHQud2lkdGggJiYgaGVpZ2h0ID09PSBuZXh0LmhlaWdodCksXG4gICAgICBzaGFyZSgpLFxuICAgICk7XG4gICAgT0JTRVJWRVJfQ0FDSEUuc2V0KHRhcmdldCwgY2FjaGUpO1xuICB9XG4gIHJldHVybiBjYWNoZTtcbn1cblxuZXhwb3J0IGNsYXNzIFNlbnRpbmVsUmVzaXplT2JzZXJ2ZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IHByb3ZpZGVyOiBPYnNlcnZhYmxlPFJlc2l6ZUV2ZW50PjtcblxuICAvKipcbiAgICogVGhlIGJ1ZmZlciBmb3IgdGhlIG9ic2VydmFibGVzIHdoaWNoIGFyZSB0aHJvdHRsZWQgYnkgdGhlIHNhbWUgdGltZVxuICAgKi9cbiAgcHJpdmF0ZSBidWZmZXI6IHsgW2tleTogbnVtYmVyXTogT2JzZXJ2YWJsZTxSZXNpemVFdmVudD4gfSA9IHt9O1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gdGFyZ2V0IFRhcmdldCB0byBsaXN0ZW4gaXRzIHJlc2l6ZSBldmVudHNcbiAgICogQHBhcmFtIHRocm90dGxlVGltZSBUaW1lIGludGVydmFsIHRvIHRocm90dGxlIHJlc2l6ZSBldmVudHNcbiAgICogPiBUaGUgdGhyb3R0bGUgdGltZSB1bmRlciA5MG1zIHdpbGwgbm90IHdvcmsgd2VsbCBiZWNhdXNlIG9mIHBlcmZvcm1hbmNlIHByb3NwZWN0cy5cbiAgICogPiBJdCB3aWxsIGZpcmUgbXVjaCBsZXNzIGV2ZW50IHRoYW4gZXhwZWN0ZWQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRhcmdldDogUmVzaXphYmxlVGFyZ2V0LFxuICAgIHByaXZhdGUgdGhyb3R0bGVUaW1lID0gOTAsXG4gICkge1xuICAgIHRoaXMucHJvdmlkZXIgPVxuICAgICAgdGFyZ2V0IGluc3RhbmNlb2YgV2luZG93ID8gd2luZG93UmVzaXplRXZlbnRQcm92aWRlcih0YXJnZXQpIDogZG9tRWxlbWVudFJlc2l6ZUV2ZW50UHJvdmlkZXIodGFyZ2V0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCYXNlIFJlc2l6ZSBPYnNlcnZhYmxlXG4gICAqXG4gICAqIEZpcmVzIG9uIGV2ZXJ5IHJlc2l6ZSBldmVudFxuICAgKlxuICAgKi9cbiAgZ2V0IHJlc2l6ZSgpOiBPYnNlcnZhYmxlPFJlc2l6ZUV2ZW50PiB7XG4gICAgcmV0dXJuIHRoaXMudGhyb3R0bGVCeSh0aGlzLnRocm90dGxlVGltZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aHJvdHRsZWQgcmVzaXplIGV2ZW50cyBieSBnaXZlbiB0aW1lXG4gICAqXG4gICAqIFNldCBgdGltZWAgYXJndW1lbnQgdG8gYDBgIGlmIHlvdSB3YW50IHRvIGNhdGNoIGFsbCBldmVudHNcbiAgICpcbiAgICogQHBhcmFtIHRpbWUgVGltZSB0byB0aHJvdHRsZSBldmVudHNcbiAgICovXG4gIHB1YmxpYyB0aHJvdHRsZUJ5KHRpbWU6IG51bWJlcik6IE9ic2VydmFibGU8UmVzaXplRXZlbnQ+IHtcbiAgICBpZiAodGltZSA8PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm92aWRlcjtcbiAgICB9XG5cbiAgICBpZiAoISh0aW1lIGluIHRoaXMuYnVmZmVyKSkge1xuICAgICAgdGhpcy5idWZmZXJbdGltZV0gPSB0aGlzLnByb3ZpZGVyLnBpcGUodGhyb3R0bGVUaW1lKHRpbWUpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5idWZmZXJbdGltZV07XG4gIH1cbn1cbiJdfQ==