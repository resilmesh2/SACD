import { CursorPaginationConverter, CursorPaginationResolver, DmtBaseOrderingConverter, QueryCursorPaginationDataResolver, } from '@sentinel/common/graphql';
import { CursorPaginationEvent, isCursorEvent } from '@sentinel/common/pagination';
import { ApolloPaginatedBaseService } from '../general/apollo-paginated-base.service';
export class ApolloPaginatedDmtService extends ApolloPaginatedBaseService {
    constructor(getQuery, operationName, options) {
        super(getQuery, operationName, options);
        this.getQuery = getQuery;
    }
    queryToPaginationData(query) {
        return QueryCursorPaginationDataResolver.resolve(this.getQueryResponse(query));
    }
    toFragments(query) {
        return this.getQueryResponse(query).data;
    }
    createInitialPaginationEvent() {
        return new CursorPaginationEvent(null, 0, undefined, undefined);
    }
    createPaginationVariables(paginationEvent) {
        if (isCursorEvent(paginationEvent)) {
            return CursorPaginationConverter.convert(paginationEvent);
        }
        else {
            throw TypeError('Unsupported type of pagination');
        }
    }
    createOrderVariables(sort, dir) {
        if (sort && sort !== '' && dir && dir !== '') {
            return DmtBaseOrderingConverter.fromSingleSort(this.strToOrderable(sort), dir);
        }
        else {
            return {};
        }
    }
    createPaginationFromQueryResult(result) {
        if (isCursorEvent(this.lastPaginationEvent)) {
            const paginationData = this.queryToPaginationData(result.data);
            return CursorPaginationResolver.resolve(paginationData, this.lastPaginationEvent);
        }
        else {
            throw TypeError('Unsupported pagination');
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBvbGxvLXBhZ2luYXRlZC1kbXQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NlbnRpbmVsLWNvbW1vbi9hcG9sbG8tc2VydmljZXMvc3JjL3BhZ2luYWJsZS9hcG9sbG8tcGFnaW5hdGVkLWRtdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFFTCx5QkFBeUIsRUFFekIsd0JBQXdCLEVBQ3hCLHdCQUF3QixFQUd4QixpQ0FBaUMsR0FDbEMsTUFBTSwwQkFBMEIsQ0FBQztBQUNsQyxPQUFPLEVBQUUscUJBQXFCLEVBQWlDLGFBQWEsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ2xILE9BQU8sRUFBRSwwQkFBMEIsRUFBaUMsTUFBTSwwQ0FBMEMsQ0FBQztBQUlySCxNQUFNLE9BQWdCLHlCQU1wQixTQUFRLDBCQUF5RjtJQUNqRyxZQUNTLFFBQTZDLEVBQ3BELGFBQXFCLEVBQ3JCLE9BQW1DO1FBRW5DLEtBQUssQ0FBQyxRQUFRLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBSmpDLGFBQVEsR0FBUixRQUFRLENBQXFDO0lBS3RELENBQUM7SUFJUyxxQkFBcUIsQ0FBQyxLQUFZO1FBQzFDLE9BQU8saUNBQWlDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7SUFFUyxXQUFXLENBQUMsS0FBWTtRQUNoQyxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDM0MsQ0FBQztJQUVTLDRCQUE0QjtRQUNwQyxPQUFPLElBQUkscUJBQXFCLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVTLHlCQUF5QixDQUFDLGVBQWlDO1FBQ25FLElBQUksYUFBYSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7WUFDbkMsT0FBTyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDNUQsQ0FBQzthQUFNLENBQUM7WUFDTixNQUFNLFNBQVMsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1FBQ3BELENBQUM7SUFDSCxDQUFDO0lBRVMsb0JBQW9CLENBQUMsSUFBYSxFQUFFLEdBQVk7UUFDeEQsSUFBSSxJQUFJLElBQUksSUFBSSxLQUFLLEVBQUUsSUFBSSxHQUFHLElBQUksR0FBRyxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQzdDLE9BQU8sd0JBQXdCLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDakYsQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUM7SUFDSCxDQUFDO0lBRVMsK0JBQStCLENBQUMsTUFBZ0M7UUFDeEUsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQztZQUM1QyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9ELE9BQU8sd0JBQXdCLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUNwRixDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sU0FBUyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDNUMsQ0FBQztJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwb2xsb1F1ZXJ5UmVzdWx0IH0gZnJvbSAnQGFwb2xsby9jbGllbnQvY29yZSc7XG5pbXBvcnQgKiBhcyBBcG9sbG8gZnJvbSAnYXBvbGxvLWFuZ3VsYXInO1xuaW1wb3J0IHtcbiAgQ3Vyc29yUGFnaW5hdGVkUmVzcG9uc2UsXG4gIEN1cnNvclBhZ2luYXRpb25Db252ZXJ0ZXIsXG4gIEN1cnNvclBhZ2luYXRpb25RdWVyeSxcbiAgQ3Vyc29yUGFnaW5hdGlvblJlc29sdmVyLFxuICBEbXRCYXNlT3JkZXJpbmdDb252ZXJ0ZXIsXG4gIERtdEJhc2VRdWVyeU9yZGVyLFxuICBRdWVyeUN1cnNvclBhZ2luYXRpb25EYXRhLFxuICBRdWVyeUN1cnNvclBhZ2luYXRpb25EYXRhUmVzb2x2ZXIsXG59IGZyb20gJ0BzZW50aW5lbC9jb21tb24vZ3JhcGhxbCc7XG5pbXBvcnQgeyBDdXJzb3JQYWdpbmF0aW9uRXZlbnQsIElQYWdpbmF0aW9uLCBJUGFnaW5hdGlvbkV2ZW50LCBpc0N1cnNvckV2ZW50IH0gZnJvbSAnQHNlbnRpbmVsL2NvbW1vbi9wYWdpbmF0aW9uJztcbmltcG9ydCB7IEFwb2xsb1BhZ2luYXRlZEJhc2VTZXJ2aWNlLCBBcG9sbG9QYWdpbmF0ZWRJbnB1dFZhcmlhYmxlcyB9IGZyb20gJy4uL2dlbmVyYWwvYXBvbGxvLXBhZ2luYXRlZC1iYXNlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBvbGxvUXVlcnlTZXJ2aWNlT3B0aW9ucyB9IGZyb20gJy4uL2dlbmVyYWwvYXBvbGxvLXF1ZXJ5LnNlcnZpY2UnO1xuaW1wb3J0IHsgT3BlcmF0aW9uVmFyaWFibGVzIH0gZnJvbSAnQGFwb2xsby9jbGllbnQvY29yZS90eXBlcyc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBcG9sbG9QYWdpbmF0ZWREbXRTZXJ2aWNlPFxuICBRdWVyeSxcbiAgUXVlcnlWYXJpYWJsZXMgZXh0ZW5kcyBPcGVyYXRpb25WYXJpYWJsZXMsXG4gIEZyYWdtZW50LFxuICBPcmRlcmFibGVCeSxcbiAgVXBkYXRlVmFyaWFibGVzIGV4dGVuZHMgQXBvbGxvUGFnaW5hdGVkSW5wdXRWYXJpYWJsZXMsXG4+IGV4dGVuZHMgQXBvbGxvUGFnaW5hdGVkQmFzZVNlcnZpY2U8UXVlcnksIFF1ZXJ5VmFyaWFibGVzLCBGcmFnbWVudCwgT3JkZXJhYmxlQnksIFVwZGF0ZVZhcmlhYmxlcz4ge1xuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGdldFF1ZXJ5OiBBcG9sbG8uUXVlcnk8UXVlcnksIFF1ZXJ5VmFyaWFibGVzPixcbiAgICBvcGVyYXRpb25OYW1lOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IEFwb2xsb1F1ZXJ5U2VydmljZU9wdGlvbnMsXG4gICkge1xuICAgIHN1cGVyKGdldFF1ZXJ5LCBvcGVyYXRpb25OYW1lLCBvcHRpb25zKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBnZXRRdWVyeVJlc3BvbnNlKHF1ZXJ5OiBRdWVyeSk6IEN1cnNvclBhZ2luYXRlZFJlc3BvbnNlPEZyYWdtZW50PjtcblxuICBwcm90ZWN0ZWQgcXVlcnlUb1BhZ2luYXRpb25EYXRhKHF1ZXJ5OiBRdWVyeSk6IFF1ZXJ5Q3Vyc29yUGFnaW5hdGlvbkRhdGEge1xuICAgIHJldHVybiBRdWVyeUN1cnNvclBhZ2luYXRpb25EYXRhUmVzb2x2ZXIucmVzb2x2ZSh0aGlzLmdldFF1ZXJ5UmVzcG9uc2UocXVlcnkpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB0b0ZyYWdtZW50cyhxdWVyeTogUXVlcnkpOiBGcmFnbWVudFtdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRRdWVyeVJlc3BvbnNlKHF1ZXJ5KS5kYXRhO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUluaXRpYWxQYWdpbmF0aW9uRXZlbnQoKTogSVBhZ2luYXRpb25FdmVudCB7XG4gICAgcmV0dXJuIG5ldyBDdXJzb3JQYWdpbmF0aW9uRXZlbnQobnVsbCwgMCwgdW5kZWZpbmVkLCB1bmRlZmluZWQpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZVBhZ2luYXRpb25WYXJpYWJsZXMocGFnaW5hdGlvbkV2ZW50OiBJUGFnaW5hdGlvbkV2ZW50KTogQ3Vyc29yUGFnaW5hdGlvblF1ZXJ5IHtcbiAgICBpZiAoaXNDdXJzb3JFdmVudChwYWdpbmF0aW9uRXZlbnQpKSB7XG4gICAgICByZXR1cm4gQ3Vyc29yUGFnaW5hdGlvbkNvbnZlcnRlci5jb252ZXJ0KHBhZ2luYXRpb25FdmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IFR5cGVFcnJvcignVW5zdXBwb3J0ZWQgdHlwZSBvZiBwYWdpbmF0aW9uJyk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZU9yZGVyVmFyaWFibGVzKHNvcnQ/OiBzdHJpbmcsIGRpcj86IHN0cmluZyk6IERtdEJhc2VRdWVyeU9yZGVyPE9yZGVyYWJsZUJ5PiB7XG4gICAgaWYgKHNvcnQgJiYgc29ydCAhPT0gJycgJiYgZGlyICYmIGRpciAhPT0gJycpIHtcbiAgICAgIHJldHVybiBEbXRCYXNlT3JkZXJpbmdDb252ZXJ0ZXIuZnJvbVNpbmdsZVNvcnQodGhpcy5zdHJUb09yZGVyYWJsZShzb3J0KSwgZGlyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVQYWdpbmF0aW9uRnJvbVF1ZXJ5UmVzdWx0KHJlc3VsdDogQXBvbGxvUXVlcnlSZXN1bHQ8UXVlcnk+KTogSVBhZ2luYXRpb24ge1xuICAgIGlmIChpc0N1cnNvckV2ZW50KHRoaXMubGFzdFBhZ2luYXRpb25FdmVudCkpIHtcbiAgICAgIGNvbnN0IHBhZ2luYXRpb25EYXRhID0gdGhpcy5xdWVyeVRvUGFnaW5hdGlvbkRhdGEocmVzdWx0LmRhdGEpO1xuICAgICAgcmV0dXJuIEN1cnNvclBhZ2luYXRpb25SZXNvbHZlci5yZXNvbHZlKHBhZ2luYXRpb25EYXRhLCB0aGlzLmxhc3RQYWdpbmF0aW9uRXZlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ1Vuc3VwcG9ydGVkIHBhZ2luYXRpb24nKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==