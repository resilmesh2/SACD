import { ActivatedRoute } from '@angular/router';
import { catchError, concatMap, distinctUntilChanged, filter, map, shareReplay, switchMap } from 'rxjs/operators';
import { NetworkStatus } from '@apollo/client/core';
import { combineLatest, EMPTY } from 'rxjs';
import { ApolloIdentifiableEntityBaseService } from './apollo-identifiable-entity-base.service';
import { inject } from '@angular/core';
export class ApolloIdentifiableRouterEntityService extends ApolloIdentifiableEntityBaseService {
    constructor(getQuery, operationName, options) {
        super(getQuery, operationName, options);
        this.getQuery = getQuery;
        this.activatedRoute = inject(ActivatedRoute);
        this.data$ = this.initVarsFromParamMap().pipe(switchMap(() => this.initialized$), shareReplay({ refCount: true }), concatMap(() => this.queryRef?.valueChanges.pipe(filter((queryRes) => queryRes.data !== undefined && queryRes.networkStatus === NetworkStatus.ready), map((queryRes) => this.toData(queryRes)), catchError(() => EMPTY)) ?? EMPTY));
    }
    initVarsFromParamMap() {
        return combineLatest([
            this.activatedRoute.paramMap,
            this.activatedRoute.queryParamMap,
            this.activatedRoute.data,
        ]).pipe(map((activatedRoute) => this.identifierFromRouteData(activatedRoute[0], activatedRoute[1], activatedRoute[2])), distinctUntilChanged(), map((identifier) => {
            if (identifier === null) {
                throw new Error('Failed to initialize from activatedRoute');
            }
            else {
                this.update(identifier);
            }
        }));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBvbGxvLWlkZW50aWZpYWJsZS1yb3V0ZXItZW50aXR5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zZW50aW5lbC1jb21tb24vYXBvbGxvLXNlcnZpY2VzL3NyYy9nZW5lcmFsL2Fwb2xsby1pZGVudGlmaWFibGUtcm91dGVyLWVudGl0eS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxjQUFjLEVBQWtCLE1BQU0saUJBQWlCLENBQUM7QUFDakUsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEgsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ3hELE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBRWhHLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkMsTUFBTSxPQUFnQixxQ0FLcEIsU0FBUSxtQ0FBZ0Y7SUFHeEYsWUFDUyxRQUE2QyxFQUNwRCxhQUFxQixFQUNyQixPQUFtQztRQUVuQyxLQUFLLENBQUMsUUFBUSxFQUFFLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUpqQyxhQUFRLEdBQVIsUUFBUSxDQUFxQztRQUg1QyxtQkFBYyxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQVFoRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLElBQUksQ0FDM0MsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFDbEMsV0FBVyxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQy9CLFNBQVMsQ0FDUCxHQUFHLEVBQUUsQ0FDSCxJQUFJLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxJQUFJLENBQzlCLE1BQU0sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxTQUFTLElBQUksUUFBUSxDQUFDLGFBQWEsS0FBSyxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQ25HLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUN4QyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQ3hCLElBQUksS0FBSyxDQUNiLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFRUyxvQkFBb0I7UUFDNUIsT0FBTyxhQUFhLENBQUM7WUFDbkIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRO1lBQzVCLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYTtZQUNqQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUk7U0FDekIsQ0FBQyxDQUFDLElBQUksQ0FDTCxHQUFHLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQzlHLG9CQUFvQixFQUFFLEVBQ3RCLEdBQUcsQ0FBQyxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ2pCLElBQUksVUFBVSxLQUFLLElBQUksRUFBRSxDQUFDO2dCQUN4QixNQUFNLElBQUksS0FBSyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7WUFDOUQsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDMUIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcGVyYXRpb25WYXJpYWJsZXMgfSBmcm9tICdAYXBvbGxvL2NsaWVudC9jb3JlL3R5cGVzJztcbmltcG9ydCAqIGFzIEFwb2xsbyBmcm9tICdhcG9sbG8tYW5ndWxhcic7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgRGF0YSwgUGFyYW1NYXAgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgY29uY2F0TWFwLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBtYXAsIHNoYXJlUmVwbGF5LCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBOZXR3b3JrU3RhdHVzIH0gZnJvbSAnQGFwb2xsby9jbGllbnQvY29yZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBFTVBUWSwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQXBvbGxvSWRlbnRpZmlhYmxlRW50aXR5QmFzZVNlcnZpY2UgfSBmcm9tICcuL2Fwb2xsby1pZGVudGlmaWFibGUtZW50aXR5LWJhc2Uuc2VydmljZSc7XG5pbXBvcnQgeyBBcG9sbG9RdWVyeVNlcnZpY2VPcHRpb25zIH0gZnJvbSAnLi9hcG9sbG8tcXVlcnkuc2VydmljZSc7XG5pbXBvcnQgeyBpbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFwb2xsb0lkZW50aWZpYWJsZVJvdXRlckVudGl0eVNlcnZpY2U8XG4gIFF1ZXJ5LFxuICBRdWVyeVZhcmlhYmxlcyBleHRlbmRzIE9wZXJhdGlvblZhcmlhYmxlcyxcbiAgRnJhZ21lbnQsXG4gIElkZW50aWZpZXIsXG4+IGV4dGVuZHMgQXBvbGxvSWRlbnRpZmlhYmxlRW50aXR5QmFzZVNlcnZpY2U8UXVlcnksIFF1ZXJ5VmFyaWFibGVzLCBGcmFnbWVudCwgSWRlbnRpZmllcj4ge1xuICBwcm90ZWN0ZWQgYWN0aXZhdGVkUm91dGUgPSBpbmplY3QoQWN0aXZhdGVkUm91dGUpO1xuXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZ2V0UXVlcnk6IEFwb2xsby5RdWVyeTxRdWVyeSwgUXVlcnlWYXJpYWJsZXM+LFxuICAgIG9wZXJhdGlvbk5hbWU6IHN0cmluZyxcbiAgICBvcHRpb25zPzogQXBvbGxvUXVlcnlTZXJ2aWNlT3B0aW9ucyxcbiAgKSB7XG4gICAgc3VwZXIoZ2V0UXVlcnksIG9wZXJhdGlvbk5hbWUsIG9wdGlvbnMpO1xuICAgIHRoaXMuZGF0YSQgPSB0aGlzLmluaXRWYXJzRnJvbVBhcmFtTWFwKCkucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLmluaXRpYWxpemVkJCksXG4gICAgICBzaGFyZVJlcGxheSh7IHJlZkNvdW50OiB0cnVlIH0pLFxuICAgICAgY29uY2F0TWFwKFxuICAgICAgICAoKSA9PlxuICAgICAgICAgIHRoaXMucXVlcnlSZWY/LnZhbHVlQ2hhbmdlcy5waXBlKFxuICAgICAgICAgICAgZmlsdGVyKChxdWVyeVJlcykgPT4gcXVlcnlSZXMuZGF0YSAhPT0gdW5kZWZpbmVkICYmIHF1ZXJ5UmVzLm5ldHdvcmtTdGF0dXMgPT09IE5ldHdvcmtTdGF0dXMucmVhZHkpLFxuICAgICAgICAgICAgbWFwKChxdWVyeVJlcykgPT4gdGhpcy50b0RhdGEocXVlcnlSZXMpKSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKCkgPT4gRU1QVFkpLFxuICAgICAgICAgICkgPz8gRU1QVFksXG4gICAgICApLFxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYWJzdHJhY3QgaWRlbnRpZmllckZyb21Sb3V0ZURhdGEoXG4gICAgcGFyYW1NYXA6IFBhcmFtTWFwLFxuICAgIHF1ZXJ5UGFyYW1NYXA6IFBhcmFtTWFwLFxuICAgIGRhdGE6IERhdGEsXG4gICk6IElkZW50aWZpZXIgfCBudWxsO1xuXG4gIHByb3RlY3RlZCBpbml0VmFyc0Zyb21QYXJhbU1hcCgpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLmFjdGl2YXRlZFJvdXRlLnBhcmFtTWFwLFxuICAgICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5xdWVyeVBhcmFtTWFwLFxuICAgICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5kYXRhLFxuICAgIF0pLnBpcGUoXG4gICAgICBtYXAoKGFjdGl2YXRlZFJvdXRlKSA9PiB0aGlzLmlkZW50aWZpZXJGcm9tUm91dGVEYXRhKGFjdGl2YXRlZFJvdXRlWzBdLCBhY3RpdmF0ZWRSb3V0ZVsxXSwgYWN0aXZhdGVkUm91dGVbMl0pKSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICBtYXAoKGlkZW50aWZpZXIpID0+IHtcbiAgICAgICAgaWYgKGlkZW50aWZpZXIgPT09IG51bGwpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIGZyb20gYWN0aXZhdGVkUm91dGUnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZShpZGVudGlmaWVyKTtcbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgKTtcbiAgfVxufVxuIl19