import { catchError, map, take } from 'rxjs/operators';
import { ApolloOperationResultResolver, createApolloContextErrorTitle, } from '@sentinel/common/graphql';
export class ApolloEntityPatchService {
    constructor(patchMutation) {
        this.patchMutation = patchMutation;
    }
    patch(event) {
        const vars = this.createVariables(event);
        return this.patchMutation
            .mutate(vars, {
            refetchQueries: this.refetchQueriesNames,
            awaitRefetchQueries: true,
            context: createApolloContextErrorTitle('Updating entity'),
        })
            .pipe(take(1), map((result) => ApolloOperationResultResolver.resolve(result)), catchError((err) => ApolloOperationResultResolver.handleError(err)));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBvbGxvLWVudGl0eS1wYXRjaC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc2VudGluZWwtY29tbW9uL2Fwb2xsby1zZXJ2aWNlcy9zcmMvZ2VuZXJhbC9hcG9sbG8tZW50aXR5LXBhdGNoLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdkQsT0FBTyxFQUNMLDZCQUE2QixFQUU3Qiw2QkFBNkIsR0FFOUIsTUFBTSwwQkFBMEIsQ0FBQztBQUlsQyxNQUFNLE9BQWdCLHdCQUF3QjtJQVE1QyxZQUFnQyxhQUEyRDtRQUEzRCxrQkFBYSxHQUFiLGFBQWEsQ0FBOEM7SUFBRyxDQUFDO0lBRS9GLEtBQUssQ0FBQyxLQUFxQztRQUN6QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLGFBQWE7YUFDdEIsTUFBTSxDQUFDLElBQUksRUFBRTtZQUNaLGNBQWMsRUFBRSxJQUFJLENBQUMsbUJBQW1CO1lBQ3hDLG1CQUFtQixFQUFFLElBQUk7WUFDekIsT0FBTyxFQUFFLDZCQUE2QixDQUFDLGlCQUFpQixDQUFDO1NBQzFELENBQUM7YUFDRCxJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsNkJBQTZCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQzlELFVBQVUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsNkJBQTZCLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQ3BFLENBQUM7SUFDTixDQUFDO0NBR0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBBcG9sbG8gZnJvbSAnYXBvbGxvLWFuZ3VsYXInO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRW50aXR5UGF0Y2hTZXJ2aWNlIH0gZnJvbSAnLi9lbnRpdHktcGF0Y2guc2VydmljZSc7XG5pbXBvcnQge1xuICBBcG9sbG9PcGVyYXRpb25SZXN1bHRSZXNvbHZlcixcbiAgQXBvbGxvUmVzdWx0LFxuICBjcmVhdGVBcG9sbG9Db250ZXh0RXJyb3JUaXRsZSxcbiAgRW50aXR5VXBkYXRlRXZlbnQsXG59IGZyb20gJ0BzZW50aW5lbC9jb21tb24vZ3JhcGhxbCc7XG5pbXBvcnQgdHlwZSB7IE9wZXJhdGlvblZhcmlhYmxlcyB9IGZyb20gJ0BhcG9sbG8vY2xpZW50L2NvcmUnO1xuaW1wb3J0IHR5cGUgeyBFbXB0eU9iamVjdCB9IGZyb20gJ2Fwb2xsby1hbmd1bGFyL3R5cGVzJztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFwb2xsb0VudGl0eVBhdGNoU2VydmljZTxcbiAgRW50aXR5UGF0Y2gsXG4gIE11dGF0aW9uLFxuICBNdXRhdGlvblZhcmlhYmxlcyBleHRlbmRzIE9wZXJhdGlvblZhcmlhYmxlcyA9IEVtcHR5T2JqZWN0LFxuPiBpbXBsZW1lbnRzIEVudGl0eVBhdGNoU2VydmljZTxFbnRpdHlQYXRjaD5cbntcbiAgcHJvdGVjdGVkIGFic3RyYWN0IHJlZmV0Y2hRdWVyaWVzTmFtZXM6IHN0cmluZ1tdO1xuXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcGF0Y2hNdXRhdGlvbjogQXBvbGxvLk11dGF0aW9uPE11dGF0aW9uLCBNdXRhdGlvblZhcmlhYmxlcz4pIHt9XG5cbiAgcGF0Y2goZXZlbnQ6IEVudGl0eVVwZGF0ZUV2ZW50PEVudGl0eVBhdGNoPik6IE9ic2VydmFibGU8QXBvbGxvUmVzdWx0PiB7XG4gICAgY29uc3QgdmFycyA9IHRoaXMuY3JlYXRlVmFyaWFibGVzKGV2ZW50KTtcbiAgICByZXR1cm4gdGhpcy5wYXRjaE11dGF0aW9uXG4gICAgICAubXV0YXRlKHZhcnMsIHtcbiAgICAgICAgcmVmZXRjaFF1ZXJpZXM6IHRoaXMucmVmZXRjaFF1ZXJpZXNOYW1lcyxcbiAgICAgICAgYXdhaXRSZWZldGNoUXVlcmllczogdHJ1ZSxcbiAgICAgICAgY29udGV4dDogY3JlYXRlQXBvbGxvQ29udGV4dEVycm9yVGl0bGUoJ1VwZGF0aW5nIGVudGl0eScpLFxuICAgICAgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICBtYXAoKHJlc3VsdCkgPT4gQXBvbGxvT3BlcmF0aW9uUmVzdWx0UmVzb2x2ZXIucmVzb2x2ZShyZXN1bHQpKSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiBBcG9sbG9PcGVyYXRpb25SZXN1bHRSZXNvbHZlci5oYW5kbGVFcnJvcihlcnIpKSxcbiAgICAgICk7XG4gIH1cblxuICBhYnN0cmFjdCBjcmVhdGVWYXJpYWJsZXMoZXZlbnQ6IEVudGl0eVVwZGF0ZUV2ZW50PEVudGl0eVBhdGNoPik6IE11dGF0aW9uVmFyaWFibGVzO1xufVxuIl19