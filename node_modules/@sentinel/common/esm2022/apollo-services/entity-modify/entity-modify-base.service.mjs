import { ActivatedRoute } from '@angular/router';
import { ApolloResultType } from '@sentinel/common/graphql';
import { BehaviorSubject } from 'rxjs';
import { concatMap, distinctUntilChanged, map, shareReplay, switchMap, tap } from 'rxjs/operators';
import { inject } from '@angular/core';
export class EntityModifyBaseService {
    constructor(entityName, notificationService) {
        this.notificationService = notificationService;
        this.isSavingSubject$ = new BehaviorSubject(false);
        this.isSaving$ = this.isSavingSubject$.asObservable().pipe(distinctUntilChanged());
        this.isLoadingSubject$ = new BehaviorSubject(true);
        this.isLoading$ = this.isLoadingSubject$.asObservable();
        this.hasErrorSubject$ = new BehaviorSubject(false);
        this.hasError$ = this.hasErrorSubject$.asObservable();
        this.activatedRoute = inject(ActivatedRoute);
        this.entityName = entityName;
        this.form$ = this.createForm().pipe(tap({
            next: () => this.isLoadingSubject$.next(false),
            error: () => {
                this.isLoadingSubject$.next(false);
                this.hasErrorSubject$.next(true);
            },
        }), shareReplay({ refCount: true, bufferSize: 1 }));
        this.canDeactivate$ = this.form$.pipe(switchMap((form) => form.dirty$), map((dirty) => !dirty), distinctUntilChanged());
    }
    cancel() {
        return this.form$.pipe(tap((form) => (form.dirty = false)), concatMap(() => this.handleCancel()));
    }
    handleSaveResult(form, result) {
        if (result.type === ApolloResultType.SUCCESS) {
            form.dirty = false;
            this.notificationService.emit('success', this.createSuccessSaveMessage());
            return this.onSaveSuccess();
        }
        else {
            return this.onSaveError();
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LW1vZGlmeS1iYXNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zZW50aW5lbC1jb21tb24vYXBvbGxvLXNlcnZpY2VzL3NyYy9lbnRpdHktbW9kaWZ5L2VudGl0eS1tb2RpZnktYmFzZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNqRCxPQUFPLEVBQWdCLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUUsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSW5HLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkMsTUFBTSxPQUFnQix1QkFBdUI7SUFpQjNDLFlBQ0UsVUFBa0IsRUFDUixtQkFBNEM7UUFBNUMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUF5QjtRQVo5QyxxQkFBZ0IsR0FBNkIsSUFBSSxlQUFlLENBQVUsS0FBSyxDQUFDLENBQUM7UUFDM0YsY0FBUyxHQUF3QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztRQUN6RixzQkFBaUIsR0FBNkIsSUFBSSxlQUFlLENBQVUsSUFBSSxDQUFDLENBQUM7UUFDM0YsZUFBVSxHQUF3QixJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDOUQscUJBQWdCLEdBQTZCLElBQUksZUFBZSxDQUFVLEtBQUssQ0FBQyxDQUFDO1FBQzNGLGNBQVMsR0FBd0IsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBRzVELG1CQUFjLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBTWhELElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FDakMsR0FBRyxDQUFDO1lBQ0YsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQzlDLEtBQUssRUFBRSxHQUFHLEVBQUU7Z0JBQ1YsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQyxDQUFDO1NBQ0YsQ0FBQyxFQUNGLFdBQVcsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQy9DLENBQUM7UUFDRixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUNuQyxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFDaEMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUN0QixvQkFBb0IsRUFBRSxDQUN2QixDQUFDO0lBQ0osQ0FBQztJQUlELE1BQU07UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUNwQixHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUNuQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQ3JDLENBQUM7SUFDSixDQUFDO0lBY1MsZ0JBQWdCLENBQUMsSUFBVSxFQUFFLE1BQW9CO1FBQ3pELElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUM3QyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztZQUNuQixJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO1lBQzFFLE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzlCLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDNUIsQ0FBQztJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IEFwb2xsb1Jlc3VsdCwgQXBvbGxvUmVzdWx0VHlwZSB9IGZyb20gJ0BzZW50aW5lbC9jb21tb24vZ3JhcGhxbCc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNvbmNhdE1hcCwgZGlzdGluY3RVbnRpbENoYW5nZWQsIG1hcCwgc2hhcmVSZXBsYXksIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQmFzZVJlYWN0aXZlRm9ybSB9IGZyb20gJ0BzZW50aW5lbC9jb21tb24nO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZUJhc2UgfSBmcm9tICcuL25vdGlmaWNhdGlvbi1zZXJ2aWNlLmJhc2UnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgaW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFbnRpdHlNb2RpZnlCYXNlU2VydmljZTxcbiAgRm9ybU1vZGVsIGV4dGVuZHMge1xuICAgIFtLIGluIGtleW9mIEZvcm1Nb2RlbF06IEFic3RyYWN0Q29udHJvbDx1bmtub3duPjtcbiAgfSxcbiAgRm9ybSBleHRlbmRzIEJhc2VSZWFjdGl2ZUZvcm08Rm9ybU1vZGVsPixcbj4ge1xuICBwcm90ZWN0ZWQgZW50aXR5TmFtZTogc3RyaW5nO1xuICBwcm90ZWN0ZWQgaXNTYXZpbmdTdWJqZWN0JDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG4gIGlzU2F2aW5nJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuaXNTYXZpbmdTdWJqZWN0JC5hc09ic2VydmFibGUoKS5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpO1xuICBwcm90ZWN0ZWQgaXNMb2FkaW5nU3ViamVjdCQ6IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4odHJ1ZSk7XG4gIGlzTG9hZGluZyQ6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzLmlzTG9hZGluZ1N1YmplY3QkLmFzT2JzZXJ2YWJsZSgpO1xuICBwcm90ZWN0ZWQgaGFzRXJyb3JTdWJqZWN0JDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG4gIGhhc0Vycm9yJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuaGFzRXJyb3JTdWJqZWN0JC5hc09ic2VydmFibGUoKTtcbiAgZm9ybSQ6IE9ic2VydmFibGU8Rm9ybT47XG4gIGNhbkRlYWN0aXZhdGUkOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBwcm90ZWN0ZWQgYWN0aXZhdGVkUm91dGUgPSBpbmplY3QoQWN0aXZhdGVkUm91dGUpO1xuXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvcihcbiAgICBlbnRpdHlOYW1lOiBzdHJpbmcsXG4gICAgcHJvdGVjdGVkIG5vdGlmaWNhdGlvblNlcnZpY2U6IE5vdGlmaWNhdGlvblNlcnZpY2VCYXNlLFxuICApIHtcbiAgICB0aGlzLmVudGl0eU5hbWUgPSBlbnRpdHlOYW1lO1xuICAgIHRoaXMuZm9ybSQgPSB0aGlzLmNyZWF0ZUZvcm0oKS5waXBlKFxuICAgICAgdGFwKHtcbiAgICAgICAgbmV4dDogKCkgPT4gdGhpcy5pc0xvYWRpbmdTdWJqZWN0JC5uZXh0KGZhbHNlKSxcbiAgICAgICAgZXJyb3I6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLmlzTG9hZGluZ1N1YmplY3QkLm5leHQoZmFsc2UpO1xuICAgICAgICAgIHRoaXMuaGFzRXJyb3JTdWJqZWN0JC5uZXh0KHRydWUpO1xuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICBzaGFyZVJlcGxheSh7IHJlZkNvdW50OiB0cnVlLCBidWZmZXJTaXplOiAxIH0pLFxuICAgICk7XG4gICAgdGhpcy5jYW5EZWFjdGl2YXRlJCA9IHRoaXMuZm9ybSQucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoZm9ybSkgPT4gZm9ybS5kaXJ0eSQpLFxuICAgICAgbWFwKChkaXJ0eSkgPT4gIWRpcnR5KSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBjcmVhdGVGb3JtKCk6IE9ic2VydmFibGU8Rm9ybT47XG5cbiAgY2FuY2VsKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmZvcm0kLnBpcGUoXG4gICAgICB0YXAoKGZvcm0pID0+IChmb3JtLmRpcnR5ID0gZmFsc2UpKSxcbiAgICAgIGNvbmNhdE1hcCgoKSA9PiB0aGlzLmhhbmRsZUNhbmNlbCgpKSxcbiAgICApO1xuICB9XG5cbiAgYWJzdHJhY3Qgc2F2ZSgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBoYW5kbGVDYW5jZWwoKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuICBwcm90ZWN0ZWQgYWJzdHJhY3Qgb25TYXZlU3VjY2VzcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBvblNhdmVFcnJvcigpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBjcmVhdGVTdWNjZXNzU2F2ZU1lc3NhZ2UoKTogc3RyaW5nO1xuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBjcmVhdGVFcnJvclNhdmVNZXNzYWdlKCk6IHN0cmluZztcblxuICBwcm90ZWN0ZWQgaGFuZGxlU2F2ZVJlc3VsdChmb3JtOiBGb3JtLCByZXN1bHQ6IEFwb2xsb1Jlc3VsdCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGlmIChyZXN1bHQudHlwZSA9PT0gQXBvbGxvUmVzdWx0VHlwZS5TVUNDRVNTKSB7XG4gICAgICBmb3JtLmRpcnR5ID0gZmFsc2U7XG4gICAgICB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2UuZW1pdCgnc3VjY2VzcycsIHRoaXMuY3JlYXRlU3VjY2Vzc1NhdmVNZXNzYWdlKCkpO1xuICAgICAgcmV0dXJuIHRoaXMub25TYXZlU3VjY2VzcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5vblNhdmVFcnJvcigpO1xuICAgIH1cbiAgfVxufVxuIl19