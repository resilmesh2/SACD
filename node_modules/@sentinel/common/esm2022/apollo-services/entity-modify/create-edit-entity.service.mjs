import { EMPTY } from 'rxjs';
import { concatMap, tap } from 'rxjs/operators';
import { EntityModifyBaseService } from './entity-modify-base.service';
export class CreateEditEntityService extends EntityModifyBaseService {
    constructor(entityName, notificationService) {
        super(entityName, notificationService);
        this.notificationService = notificationService;
        this.editMode = false;
    }
    createForm() {
        return this.getEntityId().pipe(tap((id) => (this.editMode = id !== undefined)), concatMap((id) => this.createFormFromEntityId(id)));
    }
    save() {
        return this.form$.pipe(tap(() => this.isSavingSubject$.next(true)), concatMap((form) => (form.valid ? this.createOrUpdateEntity(form) : EMPTY)), tap({
            next: () => this.isSavingSubject$.next(false),
            error: () => this.isSavingSubject$.next(false),
        }));
    }
    createOrUpdateEntity(form) {
        const save$ = this.editMode ? this.updateEntity(form) : this.createEntity(form);
        return save$.pipe(concatMap((result) => this.handleSaveResult(form, result)));
    }
    createSuccessSaveMessage() {
        return this.editMode ? `${this.entityName} was updated` : `${this.entityName} was created`;
    }
    createErrorSaveMessage() {
        const lowerCasedEntity = this.entityName.toLowerCase();
        return this.editMode ? `Updating ${lowerCasedEntity}` : `Creating ${lowerCasedEntity}`;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWVkaXQtZW50aXR5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zZW50aW5lbC1jb21tb24vYXBvbGxvLXNlcnZpY2VzL3NyYy9lbnRpdHktbW9kaWZ5L2NyZWF0ZS1lZGl0LWVudGl0eS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFHekMsT0FBTyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUloRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUV2RSxNQUFNLE9BQWdCLHVCQU1wQixTQUFRLHVCQUF3QztJQUVoRCxZQUNFLFVBQWtCLEVBQ1IsbUJBQTRDO1FBRXRELEtBQUssQ0FBQyxVQUFVLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUY3Qix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXlCO1FBSDlDLGFBQVEsR0FBRyxLQUFLLENBQUM7SUFNM0IsQ0FBQztJQUVTLFVBQVU7UUFDbEIsT0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUM1QixHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLEtBQUssU0FBUyxDQUFDLENBQUMsRUFDL0MsU0FBUyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDbkQsQ0FBQztJQUNKLENBQUM7SUFVRCxJQUFJO1FBQ0YsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDcEIsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFDM0MsU0FBUyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFDM0UsR0FBRyxDQUFDO1lBQ0YsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQzdDLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztTQUMvQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFFTyxvQkFBb0IsQ0FBQyxJQUFVO1FBQ3JDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEYsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUVTLHdCQUF3QjtRQUNoQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsY0FBYyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLGNBQWMsQ0FBQztJQUM3RixDQUFDO0lBRVMsc0JBQXNCO1FBQzlCLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN2RCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFlBQVksZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxnQkFBZ0IsRUFBRSxDQUFDO0lBQ3pGLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVNUFRZLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBCYXNlUmVhY3RpdmVGb3JtIH0gZnJvbSAnQHNlbnRpbmVsL2NvbW1vbic7XG5pbXBvcnQgeyBBcG9sbG9SZXN1bHQgfSBmcm9tICdAc2VudGluZWwvY29tbW9uL2dyYXBocWwnO1xuaW1wb3J0IHsgY29uY2F0TWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gJ0BzZW50aW5lbC9jb21tb24vdXRpbHMnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZUJhc2UgfSBmcm9tICcuL25vdGlmaWNhdGlvbi1zZXJ2aWNlLmJhc2UnO1xuaW1wb3J0IHsgRW50aXR5TW9kaWZ5QmFzZVNlcnZpY2UgfSBmcm9tICcuL2VudGl0eS1tb2RpZnktYmFzZS5zZXJ2aWNlJztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENyZWF0ZUVkaXRFbnRpdHlTZXJ2aWNlPFxuICBGb3JtTW9kZWwgZXh0ZW5kcyB7XG4gICAgW0sgaW4ga2V5b2YgRm9ybU1vZGVsXTogQWJzdHJhY3RDb250cm9sPHVua25vd24+O1xuICB9LFxuICBGb3JtIGV4dGVuZHMgQmFzZVJlYWN0aXZlRm9ybTxGb3JtTW9kZWw+LFxuICBJZGVudGlmaWVyID0gc3RyaW5nLFxuPiBleHRlbmRzIEVudGl0eU1vZGlmeUJhc2VTZXJ2aWNlPEZvcm1Nb2RlbCwgRm9ybT4ge1xuICBwcm90ZWN0ZWQgZWRpdE1vZGUgPSBmYWxzZTtcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKFxuICAgIGVudGl0eU5hbWU6IHN0cmluZyxcbiAgICBwcm90ZWN0ZWQgbm90aWZpY2F0aW9uU2VydmljZTogTm90aWZpY2F0aW9uU2VydmljZUJhc2UsXG4gICkge1xuICAgIHN1cGVyKGVudGl0eU5hbWUsIG5vdGlmaWNhdGlvblNlcnZpY2UpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUZvcm0oKTogT2JzZXJ2YWJsZTxGb3JtPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RW50aXR5SWQoKS5waXBlKFxuICAgICAgdGFwKChpZCkgPT4gKHRoaXMuZWRpdE1vZGUgPSBpZCAhPT0gdW5kZWZpbmVkKSksXG4gICAgICBjb25jYXRNYXAoKGlkKSA9PiB0aGlzLmNyZWF0ZUZvcm1Gcm9tRW50aXR5SWQoaWQpKSxcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGNyZWF0ZUZvcm1Gcm9tRW50aXR5SWQoaWQ/OiBJZGVudGlmaWVyKTogT2JzZXJ2YWJsZTxGb3JtPjtcblxuICBwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0RW50aXR5SWQoKTogT2JzZXJ2YWJsZTxPcHRpb25hbDxJZGVudGlmaWVyPj47XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IHVwZGF0ZUVudGl0eShmb3JtOiBGb3JtKTogT2JzZXJ2YWJsZTxBcG9sbG9SZXN1bHQ+O1xuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBjcmVhdGVFbnRpdHkoZm9ybTogRm9ybSk6IE9ic2VydmFibGU8QXBvbGxvUmVzdWx0PjtcblxuICBzYXZlKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmZvcm0kLnBpcGUoXG4gICAgICB0YXAoKCkgPT4gdGhpcy5pc1NhdmluZ1N1YmplY3QkLm5leHQodHJ1ZSkpLFxuICAgICAgY29uY2F0TWFwKChmb3JtKSA9PiAoZm9ybS52YWxpZCA/IHRoaXMuY3JlYXRlT3JVcGRhdGVFbnRpdHkoZm9ybSkgOiBFTVBUWSkpLFxuICAgICAgdGFwKHtcbiAgICAgICAgbmV4dDogKCkgPT4gdGhpcy5pc1NhdmluZ1N1YmplY3QkLm5leHQoZmFsc2UpLFxuICAgICAgICBlcnJvcjogKCkgPT4gdGhpcy5pc1NhdmluZ1N1YmplY3QkLm5leHQoZmFsc2UpLFxuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlT3JVcGRhdGVFbnRpdHkoZm9ybTogRm9ybSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5lZGl0TW9kZSA/IHRoaXMudXBkYXRlRW50aXR5KGZvcm0pIDogdGhpcy5jcmVhdGVFbnRpdHkoZm9ybSk7XG4gICAgcmV0dXJuIHNhdmUkLnBpcGUoY29uY2F0TWFwKChyZXN1bHQpID0+IHRoaXMuaGFuZGxlU2F2ZVJlc3VsdChmb3JtLCByZXN1bHQpKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlU3VjY2Vzc1NhdmVNZXNzYWdlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZWRpdE1vZGUgPyBgJHt0aGlzLmVudGl0eU5hbWV9IHdhcyB1cGRhdGVkYCA6IGAke3RoaXMuZW50aXR5TmFtZX0gd2FzIGNyZWF0ZWRgO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUVycm9yU2F2ZU1lc3NhZ2UoKTogc3RyaW5nIHtcbiAgICBjb25zdCBsb3dlckNhc2VkRW50aXR5ID0gdGhpcy5lbnRpdHlOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIHRoaXMuZWRpdE1vZGUgPyBgVXBkYXRpbmcgJHtsb3dlckNhc2VkRW50aXR5fWAgOiBgQ3JlYXRpbmcgJHtsb3dlckNhc2VkRW50aXR5fWA7XG4gIH1cbn1cbiJdfQ==