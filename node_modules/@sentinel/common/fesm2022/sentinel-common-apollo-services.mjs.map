{"version":3,"file":"sentinel-common-apollo-services.mjs","sources":["../../../projects/sentinel-common/apollo-services/src/entity-modify/entity-modify-base.service.ts","../../../projects/sentinel-common/apollo-services/src/entity-modify/edit-entity.service.ts","../../../projects/sentinel-common/apollo-services/src/entity-modify/create-entity.service.ts","../../../projects/sentinel-common/apollo-services/src/entity-modify/create-edit-entity.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-query.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-entities-base.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-entities.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-entity-patch.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-paginated-base.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-identifiable-entity-base.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-identifiable-entity.service.ts","../../../projects/sentinel-common/apollo-services/src/general/apollo-identifiable-router-entity.service.ts","../../../projects/sentinel-common/apollo-services/src/filterable/apollo-filterable.service.ts","../../../projects/sentinel-common/apollo-services/src/paginable/apollo-paginated-dmt.service.ts","../../../projects/sentinel-common/apollo-services/src/paginable/apollo-paginated-filterable.service.ts","../../../projects/sentinel-common/apollo-services/src/sentinel-common-apollo-services.ts"],"sourcesContent":["import { ActivatedRoute } from '@angular/router';\nimport { ApolloResult, ApolloResultType } from '@sentinel/common/graphql';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { concatMap, distinctUntilChanged, map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { BaseReactiveForm } from '@sentinel/common';\nimport { NotificationServiceBase } from './notification-service.base';\nimport { AbstractControl } from '@angular/forms';\nimport { inject } from '@angular/core';\n\nexport abstract class EntityModifyBaseService<\n  FormModel extends {\n    [K in keyof FormModel]: AbstractControl<unknown>;\n  },\n  Form extends BaseReactiveForm<FormModel>,\n> {\n  protected entityName: string;\n  protected isSavingSubject$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  isSaving$: Observable<boolean> = this.isSavingSubject$.asObservable().pipe(distinctUntilChanged());\n  protected isLoadingSubject$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n  isLoading$: Observable<boolean> = this.isLoadingSubject$.asObservable();\n  protected hasErrorSubject$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  hasError$: Observable<boolean> = this.hasErrorSubject$.asObservable();\n  form$: Observable<Form>;\n  canDeactivate$: Observable<boolean>;\n  protected activatedRoute = inject(ActivatedRoute);\n\n  protected constructor(\n    entityName: string,\n    protected notificationService: NotificationServiceBase,\n  ) {\n    this.entityName = entityName;\n    this.form$ = this.createForm().pipe(\n      tap({\n        next: () => this.isLoadingSubject$.next(false),\n        error: () => {\n          this.isLoadingSubject$.next(false);\n          this.hasErrorSubject$.next(true);\n        },\n      }),\n      shareReplay({ refCount: true, bufferSize: 1 }),\n    );\n    this.canDeactivate$ = this.form$.pipe(\n      switchMap((form) => form.dirty$),\n      map((dirty) => !dirty),\n      distinctUntilChanged(),\n    );\n  }\n\n  protected abstract createForm(): Observable<Form>;\n\n  cancel(): Observable<boolean> {\n    return this.form$.pipe(\n      tap((form) => (form.dirty = false)),\n      concatMap(() => this.handleCancel()),\n    );\n  }\n\n  abstract save(): Observable<boolean>;\n\n  protected abstract handleCancel(): Observable<boolean>;\n\n  protected abstract onSaveSuccess(): Observable<boolean>;\n\n  protected abstract onSaveError(): Observable<boolean>;\n\n  protected abstract createSuccessSaveMessage(): string;\n\n  protected abstract createErrorSaveMessage(): string;\n\n  protected handleSaveResult(form: Form, result: ApolloResult): Observable<boolean> {\n    if (result.type === ApolloResultType.SUCCESS) {\n      form.dirty = false;\n      this.notificationService.emit('success', this.createSuccessSaveMessage());\n      return this.onSaveSuccess();\n    } else {\n      return this.onSaveError();\n    }\n  }\n}\n","import { BaseReactiveForm } from '@sentinel/common';\nimport { ApolloResult } from '@sentinel/common/graphql';\nimport { Observable, of } from 'rxjs';\nimport { concatMap, tap } from 'rxjs/operators';\nimport { EntityModifyBaseService } from './entity-modify-base.service';\nimport { NotificationServiceBase } from './notification-service.base';\nimport { AbstractControl } from '@angular/forms';\n\nexport abstract class EditEntityService<\n  FormModel extends {\n    [K in keyof FormModel]: AbstractControl<unknown>;\n  },\n  Form extends BaseReactiveForm<FormModel>,\n> extends EntityModifyBaseService<FormModel, Form> {\n  protected entityId?: string;\n\n  protected constructor(\n    entityName: string,\n    protected notificationService: NotificationServiceBase,\n  ) {\n    super(entityName, notificationService);\n  }\n\n  protected abstract updateEntity(form: Form): Observable<ApolloResult>;\n\n  save(): Observable<boolean> {\n    return this.form$.pipe(concatMap((form) => (form.valid ? this.validFormSave(form) : of(false))));\n  }\n\n  protected createSuccessSaveMessage(): string {\n    return `${this.entityName} was updated`;\n  }\n\n  protected createErrorSaveMessage(): string {\n    const lowerCasedEntity = this.entityName.toLowerCase();\n    return `Updating ${lowerCasedEntity}`;\n  }\n\n  private validFormSave(form: Form): Observable<boolean> {\n    this.isSavingSubject$.next(true);\n    return this.updateEntity(form).pipe(\n      concatMap((result) => this.handleSaveResult(form, result)),\n      tap({\n        next: () => this.isSavingSubject$.next(false),\n        error: () => this.isSavingSubject$.next(false),\n      }),\n    );\n  }\n}\n","import { BaseReactiveForm } from '@sentinel/common';\nimport { NotificationServiceBase } from './notification-service.base';\nimport { EntityModifyBaseService } from './entity-modify-base.service';\nimport { Observable, of } from 'rxjs';\nimport { ApolloResult } from '@sentinel/common/graphql';\nimport { concatMap, tap } from 'rxjs/operators';\nimport { AbstractControl } from '@angular/forms';\n\nexport abstract class CreateEntityService<\n  FormModel extends {\n    [K in keyof FormModel]: AbstractControl<unknown>;\n  },\n  Form extends BaseReactiveForm<FormModel>,\n> extends EntityModifyBaseService<FormModel, Form> {\n  protected constructor(\n    entityName: string,\n    protected notificationService: NotificationServiceBase,\n  ) {\n    super(entityName, notificationService);\n  }\n\n  protected abstract createEntity(form: Form): Observable<ApolloResult>;\n\n  save(): Observable<boolean> {\n    return this.form$.pipe(concatMap((form) => (form.valid ? this.validFormSave() : of(false))));\n  }\n\n  protected createSuccessSaveMessage(): string {\n    return `${this.entityName} was created`;\n  }\n\n  protected createErrorSaveMessage(): string {\n    const lowerCasedEntity = this.entityName.toLowerCase();\n    return `Creating ${lowerCasedEntity}`;\n  }\n\n  private validFormSave(): Observable<boolean> {\n    return this.form$.pipe(\n      tap(() => this.isSavingSubject$.next(true)),\n      concatMap((form) => this.createEntity(form).pipe(concatMap((result) => this.handleSaveResult(form, result)))),\n      tap({\n        next: () => this.isSavingSubject$.next(false),\n        error: () => this.isSavingSubject$.next(false),\n      }),\n    );\n  }\n}\n","import { EMPTY, Observable } from 'rxjs';\nimport { BaseReactiveForm } from '@sentinel/common';\nimport { ApolloResult } from '@sentinel/common/graphql';\nimport { concatMap, tap } from 'rxjs/operators';\nimport { AbstractControl } from '@angular/forms';\nimport { Optional } from '@sentinel/common/utils';\nimport { NotificationServiceBase } from './notification-service.base';\nimport { EntityModifyBaseService } from './entity-modify-base.service';\n\nexport abstract class CreateEditEntityService<\n  FormModel extends {\n    [K in keyof FormModel]: AbstractControl<unknown>;\n  },\n  Form extends BaseReactiveForm<FormModel>,\n  Identifier = string,\n> extends EntityModifyBaseService<FormModel, Form> {\n  protected editMode = false;\n  protected constructor(\n    entityName: string,\n    protected notificationService: NotificationServiceBase,\n  ) {\n    super(entityName, notificationService);\n  }\n\n  protected createForm(): Observable<Form> {\n    return this.getEntityId().pipe(\n      tap((id) => (this.editMode = id !== undefined)),\n      concatMap((id) => this.createFormFromEntityId(id)),\n    );\n  }\n\n  protected abstract createFormFromEntityId(id?: Identifier): Observable<Form>;\n\n  protected abstract getEntityId(): Observable<Optional<Identifier>>;\n\n  protected abstract updateEntity(form: Form): Observable<ApolloResult>;\n\n  protected abstract createEntity(form: Form): Observable<ApolloResult>;\n\n  save(): Observable<boolean> {\n    return this.form$.pipe(\n      tap(() => this.isSavingSubject$.next(true)),\n      concatMap((form) => (form.valid ? this.createOrUpdateEntity(form) : EMPTY)),\n      tap({\n        next: () => this.isSavingSubject$.next(false),\n        error: () => this.isSavingSubject$.next(false),\n      }),\n    );\n  }\n\n  private createOrUpdateEntity(form: Form): Observable<boolean> {\n    const save$ = this.editMode ? this.updateEntity(form) : this.createEntity(form);\n    return save$.pipe(concatMap((result) => this.handleSaveResult(form, result)));\n  }\n\n  protected createSuccessSaveMessage(): string {\n    return this.editMode ? `${this.entityName} was updated` : `${this.entityName} was created`;\n  }\n\n  protected createErrorSaveMessage(): string {\n    const lowerCasedEntity = this.entityName.toLowerCase();\n    return this.editMode ? `Updating ${lowerCasedEntity}` : `Creating ${lowerCasedEntity}`;\n  }\n}\n","import { ApolloQueryResult, NetworkStatus } from '@apollo/client/core';\nimport { WatchQueryFetchPolicy } from '@apollo/client/core/watchQueryOptions';\nimport {\n  createApolloContextErrorTitle,\n  createApolloContextIgnoreErrorMessage,\n  createApolloContextRetryable,\n} from '@sentinel/common/graphql';\nimport * as Apollo from 'apollo-angular';\nimport { QueryRef } from 'apollo-angular';\nimport { BehaviorSubject, EMPTY, Observable, of } from 'rxjs';\nimport { catchError, distinctUntilChanged, filter, map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport interface ApolloQueryServiceOptions {\n  fetchPolicy?: WatchQueryFetchPolicy;\n  pollInterval?: number;\n  retryable?: boolean;\n  ignoreErrorMessage?: boolean;\n}\n\nconst DEFAULT_OPTIONS: ApolloQueryServiceOptions = {\n  fetchPolicy: 'network-only',\n  pollInterval: undefined,\n  retryable: true,\n  ignoreErrorMessage: false,\n};\n\nexport abstract class ApolloQueryService<Query, QueryVariables extends OperationVariables, Data, UpdateVariables> {\n  queryRef?: QueryRef<Query, QueryVariables>;\n  operationName: string;\n  data$: Observable<Data>;\n  isLoading$: Observable<boolean>;\n  isRefetching$: Observable<boolean>;\n  hasError$?: Observable<boolean>;\n\n  protected loadingInternal$?: Observable<boolean>;\n  protected hasErrorInternal$?: Observable<boolean>;\n  protected variables?: QueryVariables;\n  protected initialized$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  private isInErrorState = false;\n  private options: ApolloQueryServiceOptions;\n  protected abstract toData(queryRes: ApolloQueryResult<Query>): Data;\n\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    this.operationName = operationName;\n    this.options = options ?? DEFAULT_OPTIONS;\n    this.data$ = this.initialized$.pipe(\n      shareReplay({ refCount: true }),\n      switchMap(\n        () =>\n          this.queryRef?.valueChanges.pipe(\n            // ignoring all responses not containing data\n            filter((queryRes) => queryRes.data !== undefined && queryRes.networkStatus === NetworkStatus.ready),\n            map((queryRes) => this.toData(queryRes)),\n            catchError(() => EMPTY),\n          ) ?? EMPTY,\n      ),\n    );\n    this.isRefetching$ = this.initialized$.pipe(\n      switchMap(\n        () =>\n          this.queryRef?.valueChanges.pipe(\n            map(\n              (queryRes) =>\n                (queryRes.networkStatus === NetworkStatus.refetch && queryRes.loading) ||\n                queryRes.error !== undefined ||\n                false,\n            ),\n            catchError(() => of(false)),\n            distinctUntilChanged(),\n          ) ?? EMPTY,\n      ),\n    );\n    this.isLoading$ = this.initialized$.pipe(switchMap(() => this.loadingInternal$ ?? EMPTY));\n    this.hasError$ = this.initialized$.pipe(switchMap(() => this.hasErrorInternal$ ?? EMPTY));\n  }\n\n  public recoverAfterError(): void {\n    this.initialize();\n  }\n\n  protected abstract createVariables(args: UpdateVariables): QueryVariables;\n\n  protected initialize(): void {\n    this.initQueryWatch();\n    this.initLoading();\n    this.initHasError();\n    this.initialized$.next(true);\n  }\n\n  protected initQueryWatch(): void {\n    this.queryRef = this.getQuery.watch(this.variables, {\n      useInitialLoading: true,\n      pollInterval: this.options?.pollInterval ?? DEFAULT_OPTIONS.pollInterval,\n      fetchPolicy: this.options.fetchPolicy ?? DEFAULT_OPTIONS.fetchPolicy,\n      nextFetchPolicy: 'network-only',\n      errorPolicy: 'all',\n      returnPartialData: true,\n      notifyOnNetworkStatusChange: true, // to get all updates on loading state\n      context: {\n        ...createApolloContextErrorTitle(this.operationName),\n        ...createApolloContextIgnoreErrorMessage(\n          this.options?.ignoreErrorMessage !== undefined\n            ? this.options.ignoreErrorMessage\n            : DEFAULT_OPTIONS.ignoreErrorMessage ?? false,\n        ),\n        ...createApolloContextRetryable(\n          this.options?.retryable !== undefined ? this.options?.retryable : DEFAULT_OPTIONS.retryable ?? true,\n        ),\n      },\n    });\n  }\n\n  update(updateVariables: UpdateVariables): void {\n    this.variables = this.createVariables(updateVariables);\n    if (!this.initialized$.getValue()) {\n      this.initialize();\n    }\n    if (this.isInErrorState) {\n      this.initialize();\n    }\n    if (this.queryRef && this.variables) {\n      this.queryRef.setVariables(this.variables);\n    }\n  }\n\n  refetch(updateVariables: UpdateVariables): void {\n    if (this.queryRef) {\n      this.queryRef.options.context = {\n        ...this.queryRef.options.context,\n        ...createApolloContextIgnoreErrorMessage(true),\n      };\n    }\n    this.variables = this.createVariables(updateVariables);\n    this.queryRef?.refetch(this.variables);\n  }\n\n  protected initLoading(): void {\n    if (this.queryRef) {\n      this.loadingInternal$ = this.queryRef.valueChanges.pipe(\n        // we ignore refetch loadings before it causes bad ux.\n        filter((queryRes) => queryRes.networkStatus !== NetworkStatus.refetch),\n        map((queryRes) => queryRes.loading || queryRes.error !== undefined),\n        catchError(() => of(false)),\n        distinctUntilChanged(),\n      );\n    }\n  }\n\n  protected initHasError(): void {\n    if (this.queryRef) {\n      const ref = this.queryRef;\n      this.hasErrorInternal$ = ref.valueChanges.pipe(\n        map((queryRes) => this.hasError(queryRes)),\n        catchError(() => of(true)),\n        distinctUntilChanged(),\n        tap((hasError) => (this.isInErrorState = hasError)),\n      );\n    }\n  }\n\n  protected hasError(queryRes: ApolloQueryResult<Query>): boolean {\n    return (\n      queryRes.error !== undefined || queryRes.errors !== undefined || queryRes.networkStatus === NetworkStatus.error\n    );\n  }\n}\n","import { ApolloQueryResult } from '@apollo/client/core';\nimport * as Apollo from 'apollo-angular';\nimport { ApolloQueryService, ApolloQueryServiceOptions } from './apollo-query.service';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport abstract class ApolloEntitiesBaseService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  UpdateVariables,\n> extends ApolloQueryService<Query, QueryVariables, Fragment[], UpdateVariables> {\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n  }\n\n  protected abstract toFragments(query: Query): Fragment[];\n\n  protected toData(queryRes: ApolloQueryResult<Query>): Fragment[] {\n    return this.toFragments(queryRes.data);\n  }\n}\n","import * as Apollo from 'apollo-angular';\nimport { ApolloEntitiesBaseService } from './apollo-entities-base.service';\nimport { ApolloQueryServiceOptions } from './apollo-query.service';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport abstract class ApolloEntitiesService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  UpdateVariables,\n> extends ApolloEntitiesBaseService<Query, QueryVariables, Fragment, UpdateVariables> {\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n    this.initialize();\n  }\n}\n","import * as Apollo from 'apollo-angular';\nimport { Observable } from 'rxjs';\nimport { catchError, map, take } from 'rxjs/operators';\nimport { EntityPatchService } from './entity-patch.service';\nimport {\n  ApolloOperationResultResolver,\n  ApolloResult,\n  createApolloContextErrorTitle,\n  EntityUpdateEvent,\n} from '@sentinel/common/graphql';\nimport type { OperationVariables } from '@apollo/client/core';\nimport type { EmptyObject } from 'apollo-angular/types';\n\nexport abstract class ApolloEntityPatchService<\n  EntityPatch,\n  Mutation,\n  MutationVariables extends OperationVariables = EmptyObject,\n> implements EntityPatchService<EntityPatch>\n{\n  protected abstract refetchQueriesNames: string[];\n\n  protected constructor(protected patchMutation: Apollo.Mutation<Mutation, MutationVariables>) {}\n\n  patch(event: EntityUpdateEvent<EntityPatch>): Observable<ApolloResult> {\n    const vars = this.createVariables(event);\n    return this.patchMutation\n      .mutate(vars, {\n        refetchQueries: this.refetchQueriesNames,\n        awaitRefetchQueries: true,\n        context: createApolloContextErrorTitle('Updating entity'),\n      })\n      .pipe(\n        take(1),\n        map((result) => ApolloOperationResultResolver.resolve(result)),\n        catchError((err) => ApolloOperationResultResolver.handleError(err)),\n      );\n  }\n\n  abstract createVariables(event: EntityUpdateEvent<EntityPatch>): MutationVariables;\n}\n","import { ApolloQueryResult } from '@apollo/client/core';\nimport * as Apollo from 'apollo-angular';\nimport { ApolloQueryService, ApolloQueryServiceOptions } from './apollo-query.service';\nimport { IPaginatedElements, IPagination, IPaginationEvent, PaginatedResource } from '@sentinel/common/pagination';\nimport { DmtBaseQueryOrder, PaginatedData, PaginationQuery } from '@sentinel/common/graphql';\nimport { Optional } from '@sentinel/common/utils';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport type ApolloPaginatedInputVariables = { pagination: IPaginationEvent };\n\nexport abstract class ApolloPaginatedBaseService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  OrderableBy,\n  UpdateVariables extends ApolloPaginatedInputVariables = ApolloPaginatedInputVariables,\n> extends ApolloQueryService<Query, QueryVariables, IPaginatedElements<Fragment>, UpdateVariables> {\n  protected lastPaginationEvent: IPaginationEvent;\n\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n    this.lastPaginationEvent = this.createInitialPaginationEvent();\n  }\n\n  protected abstract strToOrderable(sort: string): Optional<OrderableBy>;\n\n  protected abstract createInitialPaginationEvent(): IPaginationEvent;\n\n  protected abstract queryToPaginationData(query: Query): PaginatedData;\n\n  protected abstract toFragments(query: Query): Fragment[];\n\n  protected abstract createPaginationVariables(paginationEvent: IPaginationEvent): PaginationQuery;\n\n  protected abstract createOrderVariables(sort: string, dir: string): DmtBaseQueryOrder<OrderableBy>;\n\n  protected abstract createPaginationFromQueryResult(result: ApolloQueryResult<Query>): IPagination;\n\n  update(event: UpdateVariables): void {\n    super.update(event);\n    this.lastPaginationEvent = event.pagination;\n  }\n\n  protected toData(result: ApolloQueryResult<Query>): IPaginatedElements<Fragment> {\n    const entities = this.toFragments(result.data);\n    const pagination = this.createPaginationFromQueryResult(result);\n    return new PaginatedResource<Fragment>(entities, pagination);\n  }\n}\n","import { ApolloQueryResult } from '@apollo/client/core';\nimport { Optional } from '@sentinel/common/utils';\nimport * as Apollo from 'apollo-angular';\nimport { ApolloQueryService, ApolloQueryServiceOptions } from './apollo-query.service';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport abstract class ApolloIdentifiableEntityBaseService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  Identifier,\n> extends ApolloQueryService<Query, QueryVariables, Optional<Fragment>, Identifier> {\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n  }\n\n  protected abstract toFragment(query: Query): Optional<Fragment>;\n\n  protected toData(queryRes: ApolloQueryResult<Query>): Optional<Fragment> {\n    return this.toFragment(queryRes.data);\n  }\n}\n","import * as Apollo from 'apollo-angular';\nimport { ApolloQueryServiceOptions } from './apollo-query.service';\nimport { OperationVariables } from '@apollo/client/core/types';\nimport { ApolloIdentifiableEntityBaseService } from './apollo-identifiable-entity-base.service';\n\nexport abstract class ApolloIdentifiableEntityService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Entity,\n  Identifier,\n> extends ApolloIdentifiableEntityBaseService<Query, QueryVariables, Entity, Identifier> {\n  protected initialized = false;\n\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n  }\n}\n","import { OperationVariables } from '@apollo/client/core/types';\nimport * as Apollo from 'apollo-angular';\nimport { ActivatedRoute, Data, ParamMap } from '@angular/router';\nimport { catchError, concatMap, distinctUntilChanged, filter, map, shareReplay, switchMap } from 'rxjs/operators';\nimport { NetworkStatus } from '@apollo/client/core';\nimport { combineLatest, EMPTY, Observable } from 'rxjs';\nimport { ApolloIdentifiableEntityBaseService } from './apollo-identifiable-entity-base.service';\nimport { ApolloQueryServiceOptions } from './apollo-query.service';\nimport { inject } from '@angular/core';\n\nexport abstract class ApolloIdentifiableRouterEntityService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  Identifier,\n> extends ApolloIdentifiableEntityBaseService<Query, QueryVariables, Fragment, Identifier> {\n  protected activatedRoute = inject(ActivatedRoute);\n\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n    this.data$ = this.initVarsFromParamMap().pipe(\n      switchMap(() => this.initialized$),\n      shareReplay({ refCount: true }),\n      concatMap(\n        () =>\n          this.queryRef?.valueChanges.pipe(\n            filter((queryRes) => queryRes.data !== undefined && queryRes.networkStatus === NetworkStatus.ready),\n            map((queryRes) => this.toData(queryRes)),\n            catchError(() => EMPTY),\n          ) ?? EMPTY,\n      ),\n    );\n  }\n\n  protected abstract identifierFromRouteData(\n    paramMap: ParamMap,\n    queryParamMap: ParamMap,\n    data: Data,\n  ): Identifier | null;\n\n  protected initVarsFromParamMap(): Observable<void> {\n    return combineLatest([\n      this.activatedRoute.paramMap,\n      this.activatedRoute.queryParamMap,\n      this.activatedRoute.data,\n    ]).pipe(\n      map((activatedRoute) => this.identifierFromRouteData(activatedRoute[0], activatedRoute[1], activatedRoute[2])),\n      distinctUntilChanged(),\n      map((identifier) => {\n        if (identifier === null) {\n          throw new Error('Failed to initialize from activatedRoute');\n        } else {\n          this.update(identifier);\n        }\n      }),\n    );\n  }\n}\n","import * as Apollo from 'apollo-angular';\nimport { ApolloQueryServiceOptions } from '../general/apollo-query.service';\nimport { ApolloEntitiesBaseService } from '../general/apollo-entities-base.service';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport interface FilterVariables<Filter> {\n  filter: Filter;\n}\n\nexport abstract class ApolloFilterableService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Entity,\n  ClientFilter,\n  UpdateVariables extends FilterVariables<ClientFilter> = FilterVariables<ClientFilter>,\n> extends ApolloEntitiesBaseService<Query, QueryVariables, Entity, UpdateVariables> {\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n  }\n}\n","import { ApolloQueryResult } from '@apollo/client/core';\nimport * as Apollo from 'apollo-angular';\nimport {\n  CursorPaginatedResponse,\n  CursorPaginationConverter,\n  CursorPaginationQuery,\n  CursorPaginationResolver,\n  DmtBaseOrderingConverter,\n  DmtBaseQueryOrder,\n  QueryCursorPaginationData,\n  QueryCursorPaginationDataResolver,\n} from '@sentinel/common/graphql';\nimport { CursorPaginationEvent, IPagination, IPaginationEvent, isCursorEvent } from '@sentinel/common/pagination';\nimport { ApolloPaginatedBaseService, ApolloPaginatedInputVariables } from '../general/apollo-paginated-base.service';\nimport { ApolloQueryServiceOptions } from '../general/apollo-query.service';\nimport { OperationVariables } from '@apollo/client/core/types';\n\nexport abstract class ApolloPaginatedDmtService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  OrderableBy,\n  UpdateVariables extends ApolloPaginatedInputVariables,\n> extends ApolloPaginatedBaseService<Query, QueryVariables, Fragment, OrderableBy, UpdateVariables> {\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n  }\n\n  protected abstract getQueryResponse(query: Query): CursorPaginatedResponse<Fragment>;\n\n  protected queryToPaginationData(query: Query): QueryCursorPaginationData {\n    return QueryCursorPaginationDataResolver.resolve(this.getQueryResponse(query));\n  }\n\n  protected toFragments(query: Query): Fragment[] {\n    return this.getQueryResponse(query).data;\n  }\n\n  protected createInitialPaginationEvent(): IPaginationEvent {\n    return new CursorPaginationEvent(null, 0, undefined, undefined);\n  }\n\n  protected createPaginationVariables(paginationEvent: IPaginationEvent): CursorPaginationQuery {\n    if (isCursorEvent(paginationEvent)) {\n      return CursorPaginationConverter.convert(paginationEvent);\n    } else {\n      throw TypeError('Unsupported type of pagination');\n    }\n  }\n\n  protected createOrderVariables(sort?: string, dir?: string): DmtBaseQueryOrder<OrderableBy> {\n    if (sort && sort !== '' && dir && dir !== '') {\n      return DmtBaseOrderingConverter.fromSingleSort(this.strToOrderable(sort), dir);\n    } else {\n      return {};\n    }\n  }\n\n  protected createPaginationFromQueryResult(result: ApolloQueryResult<Query>): IPagination {\n    if (isCursorEvent(this.lastPaginationEvent)) {\n      const paginationData = this.queryToPaginationData(result.data);\n      return CursorPaginationResolver.resolve(paginationData, this.lastPaginationEvent);\n    } else {\n      throw TypeError('Unsupported pagination');\n    }\n  }\n}\n","import * as Apollo from 'apollo-angular';\nimport { ApolloQueryServiceOptions } from '../general/apollo-query.service';\nimport { OperationVariables } from '@apollo/client/core/types';\nimport { ApolloPaginatedInputVariables } from '../general/apollo-paginated-base.service';\nimport { ApolloPaginatedDmtService } from './apollo-paginated-dmt.service';\n\nexport interface ApolloPaginatedFilterableInputVariables<Filter> extends ApolloPaginatedInputVariables {\n  filter: Filter;\n}\n\nexport abstract class ApolloPaginatedFilterableService<\n  Query,\n  QueryVariables extends OperationVariables,\n  Fragment,\n  OrderableBy,\n  ClientFilter,\n  UpdateVariables extends\n    ApolloPaginatedFilterableInputVariables<ClientFilter> = ApolloPaginatedFilterableInputVariables<ClientFilter>,\n> extends ApolloPaginatedDmtService<Query, QueryVariables, Fragment, OrderableBy, UpdateVariables> {\n  protected constructor(\n    public getQuery: Apollo.Query<Query, QueryVariables>,\n    operationName: string,\n    options?: ApolloQueryServiceOptions,\n  ) {\n    super(getQuery, operationName, options);\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}