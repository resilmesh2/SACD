{"version":3,"file":"sentinel-common-dynamic-env.mjs","sources":["../../../projects/sentinel-common/dynamic-env/src/config-factory.ts","../../../projects/sentinel-common/dynamic-env/src/dynamic-environment.ts","../../../projects/sentinel-common/dynamic-env/src/sentinel-bootstrap.ts","../../../projects/sentinel-common/dynamic-env/src/sentinel-common-dynamic-env.ts"],"sourcesContent":["import { InjectionToken, Provider } from '@angular/core';\nimport { SentinelConfig } from './sentinel-config';\nimport { ExtendedWindow } from './extended-window';\n\n/**\n * Injection token of the application's dynamic config. Can be useful for dynamic injection into other modules\n * Use as dependency for providing a config through injections token and configurableModuleFactory.\n */\nexport const APP_CONFIG: InjectionToken<SentinelConfig> = new InjectionToken('SentinelConfig');\n\nconst appConfigFactory = appConfigFactoryFunc;\n\n/**\n * App config provider. Provides dynamic config at runtime using a factory function.\n * USAGE EXAMPLE:\n *  @NgModule({\n *     declarations: [AppComponent],\n *     imports: [BrowserModule,],\n *     providers: [appConfigProvider]\n *     bootstrap: [AppComponent]\n *   })\n *  export class AppModule {}\n */\nexport const appConfigProvider: Provider = { provide: APP_CONFIG, useFactory: appConfigFactory };\n\n/**\n * Allows access to parts of a config dynamically, at runtime.\n * USAGE EXAMPLE:\n *  @NgModule({\n *   imports: [CommonModule, SentinelAuthModule.forRoot(null)],\n *   providers: [\n *     {\n *       provide: SentinelAuthConfig,\n *       useFactory: configurableModuleFactory<KypoConfig>('authConfig'),\n *       deps: [APP_CONFIG],\n *     },\n *   ],\n * })\n *  export class AuthModule {}\n */\nexport const configurableModuleFactory = configurableModuleFactoryFunc;\n\nexport type ConfigFactoryFunction<T extends SentinelConfig> = (config: T) => unknown;\n\nfunction configurableModuleFactoryFunc<T extends SentinelConfig>(prop: string): ConfigFactoryFunction<T> {\n  return (sentinelConfig: T): unknown => sentinelConfig[prop];\n}\n\nfunction appConfigFactoryFunc<T extends SentinelConfig>(): T {\n  return (window as unknown as ExtendedWindow<T>).sentinelAppConfig;\n}\n","import { ExtendedWindow } from './extended-window';\nimport { SentinelConfig } from './sentinel-config';\n\n/**\n * Replacement of Angular's environment constants. This environment supports populating its properties at the run-time\n * loaded from an external file, thus supporting a build once deploy many approach in Angular.\n * RECOMMENDED USAGE:\n * Wrap this class with custom class to avoid the need for providing type with each call to getConfig method.\n * For example:\n * export class MyDynamicEnvironment {\n *   public static getConfig(): MyCustomConfig {\n *     return DynamicEnvironment.getConfig<MyCustomConfig>();\n *   }\n * }\n *\n * Then access the config from application's code like:\n *\n * const config: MyCustomConfig = MyDynamicEnvironment.getConfig();\n *\n * vs\n *\n * const config: MyCustomConfig = DynamicEnvironment.getConfig<MyCustomConfig>();\n */\nexport class DynamicEnvironment {\n  public static getConfig<T extends SentinelConfig>(): T {\n    return (window as unknown as ExtendedWindow<T>).sentinelAppConfig;\n  }\n\n  static setConfig<T extends SentinelConfig>(config: T): void {\n    (window as unknown as ExtendedWindow<T>).sentinelAppConfig = config;\n  }\n}\n","import { DynamicEnvironment } from './dynamic-environment';\nimport { SentinelConfig } from './sentinel-config';\nimport { BootstrapOptions, CompilerOptions, NgModuleRef, PlatformRef, Type } from '@angular/core';\n\n/**\n * Custom bootstrapper. Fetches a config JSON file from provided url, parses it and sets it as dynamic environment before\n * bootstrapping provided module.\n * Optionally, custom platform can be provided. platformBrowserDynamic is used by default.\n */\nexport class SentinelBootstrapper {\n  static bootstrap<T, U extends SentinelConfig>(\n    url: string,\n    moduleType: Type<T>,\n    platform: PlatformRef,\n    compilerOptions?: (CompilerOptions & BootstrapOptions) | Array<CompilerOptions & BootstrapOptions>,\n  ): Promise<NgModuleRef<T>> {\n    return fetch(url)\n      .then((response) => response.json())\n      .then((config: U) => {\n        DynamicEnvironment.setConfig(config);\n        return platform.bootstrapModule(moduleType, compilerOptions).catch((err) => {\n          console.error(err);\n          throw new Error(err);\n        });\n      })\n      .catch((err) => {\n        console.error(err);\n        throw new Error(err);\n      });\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":";;AAIA;;;AAGG;MACU,UAAU,GAAmC,IAAI,cAAc,CAAC,gBAAgB,EAAE;AAE/F,MAAM,gBAAgB,GAAG,oBAAoB,CAAC;AAE9C;;;;;;;;;;AAUG;AACI,MAAM,iBAAiB,GAAa,EAAE,OAAO,EAAE,UAAU,EAAE,UAAU,EAAE,gBAAgB,GAAG;AAEjG;;;;;;;;;;;;;;AAcG;AACI,MAAM,yBAAyB,GAAG,8BAA8B;AAIvE,SAAS,6BAA6B,CAA2B,IAAY,EAAA;IAC3E,OAAO,CAAC,cAAiB,KAAc,cAAc,CAAC,IAAI,CAAC,CAAC;AAC9D,CAAC;AAED,SAAS,oBAAoB,GAAA;IAC3B,OAAQ,MAAuC,CAAC,iBAAiB,CAAC;AACpE;;AC/CA;;;;;;;;;;;;;;;;;;;AAmBG;MACU,kBAAkB,CAAA;AACtB,IAAA,OAAO,SAAS,GAAA;QACrB,OAAQ,MAAuC,CAAC,iBAAiB,CAAC;KACnE;IAED,OAAO,SAAS,CAA2B,MAAS,EAAA;AACjD,QAAA,MAAuC,CAAC,iBAAiB,GAAG,MAAM,CAAC;KACrE;AACF;;AC3BD;;;;AAIG;MACU,oBAAoB,CAAA;IAC/B,OAAO,SAAS,CACd,GAAW,EACX,UAAmB,EACnB,QAAqB,EACrB,eAAkG,EAAA;QAElG,OAAO,KAAK,CAAC,GAAG,CAAC;aACd,IAAI,CAAC,CAAC,QAAQ,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;AACnC,aAAA,IAAI,CAAC,CAAC,MAAS,KAAI;AAClB,YAAA,kBAAkB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AACrC,YAAA,OAAO,QAAQ,CAAC,eAAe,CAAC,UAAU,EAAE,eAAe,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,KAAI;AACzE,gBAAA,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACnB,gBAAA,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;AACvB,aAAC,CAAC,CAAC;AACL,SAAC,CAAC;AACD,aAAA,KAAK,CAAC,CAAC,GAAG,KAAI;AACb,YAAA,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACnB,YAAA,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;AACvB,SAAC,CAAC,CAAC;KACN;AACF;;AC9BD;;AAEG;;;;"}