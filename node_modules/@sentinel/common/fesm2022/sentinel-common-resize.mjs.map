{"version":3,"file":"sentinel-common-resize.mjs","sources":["../../../projects/sentinel-common/resize/src/sentinel-resize-observer.ts","../../../projects/sentinel-common/resize/src/sentinel-resize-manager.ts","../../../projects/sentinel-common/resize/src/sentinel-resize.service.ts","../../../projects/sentinel-common/resize/src/sentinel-resize.directive.ts","../../../projects/sentinel-common/resize/src/sentinel-common-resize.ts"],"sourcesContent":["import { fromEvent, mergeWith, Observable, share, Subject } from 'rxjs';\nimport { distinctUntilChanged, filter, map, throttleTime } from 'rxjs/operators';\n\n/**\n * Resizable Target Type (HTMLElement or Window)\n */\nexport type ResizableTarget = HTMLElement | Window;\n\n/**\n * Resize Event\n */\nexport interface ResizeEvent {\n  /**\n   * width of the target in pixels\n   */\n  width: number;\n\n  /**\n   * height of the target in pixels\n   */\n  height: number;\n}\n\n/**\n * Resize Event provider of all registered elements\n */\nconst RESIZE_EVENTS_SUBJECT = new Subject<ResizeObserverEntry>();\n\n/**\n * Observable instance of RESIZE_EVENTS_SUBJECT\n * @see RESIZE_EVENTS_SUBJECT\n */\nconst RESIZE_EVENTS = RESIZE_EVENTS_SUBJECT.pipe(share());\n\n/**\n * Html Elements' Resize Observer\n */\nconst RESIZE_OBSERVER = new ResizeObserver((entries) => {\n  entries.forEach((entry) => RESIZE_EVENTS_SUBJECT.next(entry));\n});\n\n/**\n * Mutation Event provider of all registered elements\n */\nconst MUTATION_EVENTS_SUBJECT = new Subject<MutationRecord>();\n\n/**\n * Observable instance of MUTATION_EVENTS_SUBJECT\n * @see MUTATION_EVENTS_SUBJECT\n */\nconst MUTATION_EVENTS = MUTATION_EVENTS_SUBJECT.pipe(share());\n\n/**\n * Html Elements' Mutation Observer\n */\nconst MUTATION_OBSERVER = new MutationObserver((records) => {\n  records.forEach((record) => MUTATION_EVENTS_SUBJECT.next(record));\n});\n\n/**\n * Cache observed elements and observables\n */\nconst OBSERVER_CACHE = new WeakMap<ResizableTarget, Observable<ResizeEvent>>();\n\n/**\n * Creates and registers resize observer for a window instance\n * @param target Target Window Object\n */\nfunction windowResizeEventProvider(target: Window): Observable<ResizeEvent> {\n  let cache = OBSERVER_CACHE.get(target);\n\n  if (!cache) {\n    cache = fromEvent(target, 'resize').pipe(\n      map(() => {\n        if (target instanceof Window) {\n          return { width: target.innerWidth, height: target.innerHeight };\n        } else {\n          throw new Error('Error');\n        }\n      }),\n      share(),\n    );\n    OBSERVER_CACHE.set(target, cache);\n  }\n  return cache;\n}\n\n/**\n * Creates and registers resize observer for an HTMLElement instance\n * @param target Target Window Object\n */\nfunction domElementResizeEventProvider(target: HTMLElement): Observable<ResizeEvent> {\n  let cache = OBSERVER_CACHE.get(target);\n\n  if (!cache) {\n    RESIZE_OBSERVER.observe(target);\n    MUTATION_OBSERVER.observe(target, { attributes: true, characterData: true, subtree: true, childList: true });\n\n    cache = RESIZE_EVENTS.pipe(\n      filter((e) => e.target === target),\n      map((entry) => <ResizeEvent>{ width: entry.contentRect.width, height: entry.contentRect.height }),\n      mergeWith(\n        MUTATION_EVENTS.pipe(\n          filter((record) => record.type !== 'attributes'),\n          map(() => <ResizeEvent>{ width: target.offsetWidth, height: target.offsetHeight }),\n        ),\n      ),\n      distinctUntilChanged(({ width, height }, next) => width === next.width && height === next.height),\n      share(),\n    );\n    OBSERVER_CACHE.set(target, cache);\n  }\n  return cache;\n}\n\nexport class SentinelResizeObserver {\n  private readonly provider: Observable<ResizeEvent>;\n\n  /**\n   * The buffer for the observables which are throttled by the same time\n   */\n  private buffer: { [key: number]: Observable<ResizeEvent> } = {};\n\n  /**\n   * @param target Target to listen its resize events\n   * @param throttleTime Time interval to throttle resize events\n   * > The throttle time under 90ms will not work well because of performance prospects.\n   * > It will fire much less event than expected.\n   */\n  constructor(\n    private target: ResizableTarget,\n    private throttleTime = 90,\n  ) {\n    this.provider =\n      target instanceof Window ? windowResizeEventProvider(target) : domElementResizeEventProvider(target);\n  }\n\n  /**\n   * Base Resize Observable\n   *\n   * Fires on every resize event\n   *\n   */\n  get resize(): Observable<ResizeEvent> {\n    return this.throttleBy(this.throttleTime);\n  }\n\n  /**\n   * Returns throttled resize events by given time\n   *\n   * Set `time` argument to `0` if you want to catch all events\n   *\n   * @param time Time to throttle events\n   */\n  public throttleBy(time: number): Observable<ResizeEvent> {\n    if (time <= 0) {\n      return this.provider;\n    }\n\n    if (!(time in this.buffer)) {\n      this.buffer[time] = this.provider.pipe(throttleTime(time));\n    }\n\n    return this.buffer[time];\n  }\n}\n","import { ResizableTarget, SentinelResizeObserver } from './sentinel-resize-observer';\n\nexport class SentinelResizeManager {\n  private _buffer = new Map<ResizableTarget, SentinelResizeObserver>();\n\n  constructor(private observerThrottleTime: number = 90) {}\n\n  public observe(target: ResizableTarget, throttleTime = this.observerThrottleTime): SentinelResizeObserver {\n    const observer = this._buffer.get(target);\n    if (observer) {\n      return observer;\n    } else {\n      const newObserver = new SentinelResizeObserver(target, throttleTime);\n      this._buffer.set(target, newObserver);\n      return newObserver;\n    }\n  }\n\n  public get root(): SentinelResizeObserver {\n    return this.observe(window);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { SentinelResizeManager } from './sentinel-resize-manager';\nimport { ResizeEvent } from './sentinel-resize-observer';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class SentinelResizeService {\n  private static manager: SentinelResizeManager = new SentinelResizeManager(0);\n\n  public windowResize$: Observable<ResizeEvent> = SentinelResizeService.manager.root.resize;\n\n  public observe(target: HTMLElement, throttleBy = 90): Observable<ResizeEvent> {\n    return SentinelResizeService.manager.observe(target).throttleBy(throttleBy);\n  }\n}\n","import { DestroyRef, Directive, ElementRef, EventEmitter, Output } from '@angular/core';\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\nimport { SentinelResizeService } from './sentinel-resize.service';\nimport { ResizeEvent } from './sentinel-resize-observer';\n\n@Directive({\n  selector: '[sentinelResize]',\n  standalone: true,\n})\nexport class SentinelResizeDirective {\n  @Output() sentinelResize: EventEmitter<ResizeEvent> = new EventEmitter<ResizeEvent>();\n\n  constructor(\n    service: SentinelResizeService,\n    { nativeElement }: ElementRef,\n    private destroyRef: DestroyRef,\n  ) {\n    service\n      .observe(nativeElement, 0)\n      .pipe(takeUntilDestroyed(this.destroyRef))\n      .subscribe((event) => {\n        this.sentinelResize.emit(event);\n      });\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["i1.SentinelResizeService"],"mappings":"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"}