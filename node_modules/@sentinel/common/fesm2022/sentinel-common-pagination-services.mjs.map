{"version":3,"file":"sentinel-common-pagination-services.mjs","sources":["../../../projects/sentinel-common/pagination-services/src/pagination-token.ts","../../../projects/sentinel-common/pagination-services/src/pagination-base-init.ts","../../../projects/sentinel-common/pagination-services/src/pagination.service.ts","../../../projects/sentinel-common/pagination-services/src/offset-pagination-resolver.ts","../../../projects/sentinel-common/pagination-services/src/query-param-pagination.service.ts","../../../projects/sentinel-common/pagination-services/src/sentinel-common-pagination-services.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { PaginationBaseInit } from './pagination-base-init';\nimport { PaginationType } from './types';\n\nexport const INIT_PAGINATION_EVENT_BASE_TOKEN = new InjectionToken<PaginationBaseInit>('INIT_PAGINATION_EVENT_TOKEN');\nexport const PAGINATION_TYPE_TOKEN = new InjectionToken<PaginationType>('PAGINATION_TYPE_TOKEN');\nexport const MAX_PAGINATION_SIZE_TOKEN = new InjectionToken<number>('MAX_PAGINATION_SIZE_TOKEN');\n","import { PaginationBase } from './pagination-base';\nimport { SortDir } from '@sentinel/common/pagination';\n\nexport class PaginationBaseInit implements PaginationBase {\n  size: number;\n  sort?: string;\n  sortDir?: SortDir;\n\n  constructor(size: number, sort?: string, sortDir?: SortDir) {\n    this.size = size;\n    this.sort = sort;\n    this.sortDir = sortDir;\n  }\n}\n","import { Inject, Injectable, Optional } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { distinctUntilChanged, shareReplay } from 'rxjs/operators';\nimport { PaginationBase } from './pagination-base';\nimport { PaginationBaseInit } from './pagination-base-init';\nimport { INIT_PAGINATION_EVENT_BASE_TOKEN, PAGINATION_TYPE_TOKEN } from './pagination-token';\nimport { PaginationType } from './types';\nimport equal from 'fast-deep-equal/es6';\nimport {\n  CursorRequestedPaginationManager,\n  IPaginationEvent,\n  isOffsetEvent,\n  OffsetPaginationEvent,\n  OffsetRequestedPaginationManager,\n  RequestedPaginationManager,\n  isCursorEvent,\n  CursorPaginationEvent,\n} from '@sentinel/common/pagination';\n\n@Injectable()\nexport class PaginationService {\n  readonly INIT_PAGINATION: IPaginationEvent;\n  protected paginationManager: RequestedPaginationManager;\n  pagination$: Observable<IPaginationEvent>;\n\n  constructor(\n    @Optional() @Inject(INIT_PAGINATION_EVENT_BASE_TOKEN) protected readonly initPaginationBase?: PaginationBaseInit,\n    @Optional() @Inject(PAGINATION_TYPE_TOKEN) protected readonly paginationType?: PaginationType,\n  ) {\n    if (!paginationType) {\n      this.paginationType = 'cursor';\n    }\n    this.INIT_PAGINATION = createInitPagination(this.paginationType ?? 'cursor', this.initPaginationBase);\n    this.paginationManager = createPaginationManager(\n      this.INIT_PAGINATION.size,\n      this.INIT_PAGINATION,\n      this.paginationType ?? 'cursor',\n    );\n    this.pagination$ = this.paginationManager.pagination$.asObservable().pipe(\n      distinctUntilChanged((prev, curr) => equal(prev, curr)),\n      shareReplay({ refCount: true }),\n    );\n  }\n\n  get(): IPaginationEvent {\n    return this.paginationManager.pagination$.getValue();\n  }\n\n  update(pagination: IPaginationEvent): void {\n    this.paginationManager.update(pagination);\n  }\n\n  resetPosition(): void {\n    this.paginationManager.resetPosition();\n  }\n\n  resetSize(): void {\n    this.paginationManager.resetSize();\n  }\n}\n\nexport function createInitPagination(\n  paginationType: PaginationType,\n  initPaginationBase?: PaginationBase,\n): IPaginationEvent {\n  const paginationBase: PaginationBase = initPaginationBase ?? { size: 10, sort: undefined, sortDir: undefined };\n  if (paginationType === 'offset') {\n    return new OffsetPaginationEvent(0, paginationBase.size, paginationBase.sort, paginationBase.sortDir);\n  } else if (paginationType === 'cursor') {\n    return new CursorPaginationEvent(null, paginationBase.size, paginationBase.sort, paginationBase.sortDir);\n  } else {\n    throw new Error(`PaginationType does not match supported values 'offset' and 'cursor'`);\n  }\n}\n\nexport function createPaginationManager(\n  initSize: number,\n  initPagination: IPaginationEvent,\n  paginationType: PaginationType,\n): RequestedPaginationManager {\n  if (paginationType === 'offset' && isOffsetEvent(initPagination)) {\n    return new OffsetRequestedPaginationManager(initSize, initPagination);\n  } else if (paginationType === 'cursor' && isCursorEvent(initPagination)) {\n    return new CursorRequestedPaginationManager(initSize, initPagination);\n  } else {\n    throw new TypeError('Incompatible pagination type and initial pagination');\n  }\n}\n","import { QueryOffsetPaginationData } from '@sentinel/common/graphql';\nimport { IOffsetPagination, IOffsetPaginationEvent, OffsetPagination } from '@sentinel/common/pagination';\n\nexport class OffsetPaginationResolver {\n  static resolve(queryData: QueryOffsetPaginationData, paginationEvent: IOffsetPaginationEvent): IOffsetPagination {\n    const size = paginationEvent.size;\n    return new OffsetPagination(\n      paginationEvent.page,\n      queryData.elementsCount,\n      size,\n      queryData.totalCount,\n      Math.ceil(queryData.totalCount / size),\n    );\n  }\n}\n","import { Inject, Injectable, Optional } from '@angular/core';\nimport { ActivatedRoute, ParamMap } from '@angular/router';\nimport {\n  Optional as Maybe,\n  propertyOf,\n  QueryParamsNavigationQueueService,\n  toQueryParams,\n} from '@sentinel/common/utils';\nimport { from, Observable } from 'rxjs';\nimport { concatMap, map, shareReplay, take, tap } from 'rxjs/operators';\nimport { PaginationBase } from './pagination-base';\nimport { PaginationBaseInit } from './pagination-base-init';\nimport { INIT_PAGINATION_EVENT_BASE_TOKEN, MAX_PAGINATION_SIZE_TOKEN, PAGINATION_TYPE_TOKEN } from './pagination-token';\nimport { createPaginationManager, PaginationService } from './pagination.service';\nimport { PaginationType } from './types';\nimport { CursorPaginationEvent, IPaginationEvent, OffsetPaginationEvent } from '@sentinel/common/pagination';\n\n@Injectable()\nexport class QueryParamPaginationService extends PaginationService {\n  readonly maxPaginationSize: number;\n  constructor(\n    private activatedRoute: ActivatedRoute,\n    private queryParamsQueueService: QueryParamsNavigationQueueService,\n    @Optional() @Inject(INIT_PAGINATION_EVENT_BASE_TOKEN) protected readonly initPaginationBase?: PaginationBaseInit,\n    @Optional() @Inject(PAGINATION_TYPE_TOKEN) protected readonly paginationType?: PaginationType,\n    @Optional() @Inject(MAX_PAGINATION_SIZE_TOKEN) protected readonly initMaxPaginationSize?: number,\n  ) {\n    super(initPaginationBase, paginationType);\n    if (!paginationType) {\n      this.paginationType = 'cursor';\n    }\n    this.maxPaginationSize = initMaxPaginationSize ? initMaxPaginationSize : 100;\n    this.pagination$ = this.createPaginationObservable();\n  }\n\n  protected updateQueryParams(pagination: IPaginationEvent): Observable<boolean> {\n    return from(this.queryParamsQueueService.enqueue(toQueryParams<IPaginationEvent>(pagination)));\n  }\n\n  private createPaginationObservable(): Observable<IPaginationEvent> {\n    return this.fromRoute().pipe(\n      tap(\n        (pagination) =>\n          (this.paginationManager = createPaginationManager(\n            this.INIT_PAGINATION.size,\n            pagination,\n            this.paginationType ?? 'cursor',\n          )),\n      ),\n      concatMap(() => this.paginationManager.pagination$),\n      concatMap((pagination) => this.updateQueryParams(pagination).pipe(map(() => pagination))),\n      shareReplay({ refCount: true }),\n    );\n  }\n\n  private fromRoute(): Observable<IPaginationEvent> {\n    return this.activatedRoute.queryParamMap.pipe(\n      take(1),\n      map((paramMap) => this.paginationFromParamMap(paramMap)),\n    );\n  }\n\n  private paginationFromParamMap(paramMap: ParamMap): IPaginationEvent {\n    let pagination: Maybe<IPaginationEvent>;\n    if (this.paginationType === 'offset') {\n      pagination = this.offsetPaginationFromParamMap(paramMap);\n    } else if (this.paginationType === 'cursor') {\n      pagination = this.cursorPaginationFromParamMap(paramMap);\n    }\n    return pagination ?? this.INIT_PAGINATION;\n  }\n\n  private offsetPaginationFromParamMap(paramMap: ParamMap): Maybe<IPaginationEvent> {\n    const paginationBase = this.paginationBaseFromParamMap(paramMap);\n    const pageStr = paramMap.get('page');\n    if (paginationBase && pageStr !== null) {\n      const parsedPage = Number.parseInt(pageStr);\n      if (Number.isInteger(parsedPage)) {\n        const page = Math.max(parsedPage, 0);\n        return new OffsetPaginationEvent(page, paginationBase.size, paginationBase.sort, paginationBase.sortDir);\n      }\n    }\n    return undefined;\n  }\n\n  private cursorPaginationFromParamMap(paramMap: ParamMap): Maybe<IPaginationEvent> {\n    const paginationBase = this.paginationBaseFromParamMap(paramMap);\n    const cursor = paramMap.get('cursor');\n    if (paginationBase) {\n      return new CursorPaginationEvent(cursor, paginationBase.size, paginationBase.sort, paginationBase.sortDir);\n    }\n    return undefined;\n  }\n\n  private paginationBaseFromParamMap(paramMap: ParamMap): Maybe<PaginationBase> {\n    const sizeStr = paramMap.get(propertyOf<PaginationBase>('size'));\n    const sort = paramMap.get(propertyOf<PaginationBase>('sort'));\n    const sortDir = paramMap.get(propertyOf<PaginationBase>('sortDir'));\n    if (sizeStr !== null) {\n      const parsedSize = Number.parseInt(sizeStr);\n      if (Number.isInteger(parsedSize)) {\n        const positiveSize = Math.max(parsedSize, 1);\n        const size = Math.min(positiveSize, this.maxPaginationSize);\n        if (sort !== null && sortDir !== null) {\n          return { size: size, sort, sortDir: sortDir === 'asc' ? 'asc' : 'desc' };\n        } else {\n          return { size: size, sort: undefined, sortDir: undefined };\n        }\n      }\n    }\n    return undefined;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}