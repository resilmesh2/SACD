{"version":3,"file":"sentinel-common-graphql.mjs","sources":["../../../projects/sentinel-common/graphql/src/entity/apollo-result.ts","../../../projects/sentinel-common/graphql/src/entity/apollo-result-type.ts","../../../projects/sentinel-common/graphql/src/api/dmt/dmt-base-ordering-converter.ts","../../../projects/sentinel-common/graphql/src/api/dmt/pagination-converter.ts","../../../projects/sentinel-common/graphql/src/api/dmt/query-pagination-data-resolver.ts","../../../projects/sentinel-common/graphql/src/api/graphql-context-util.ts","../../../projects/sentinel-common/graphql/src/api/apollo-operation-result-resolver.ts","../../../projects/sentinel-common/graphql/src/api/pagination-resolver.ts","../../../projects/sentinel-common/graphql/src/sentinel-common-graphql.ts"],"sourcesContent":["import { GraphQLError } from 'graphql';\nimport { ApolloResultType } from './apollo-result-type';\n\nexport class ApolloResult {\n  type: ApolloResultType;\n  errors?: ReadonlyArray<GraphQLError>;\n  constructor(type: ApolloResultType, errors?: ReadonlyArray<GraphQLError>) {\n    this.type = type;\n    this.errors = errors;\n  }\n}\n","export enum ApolloResultType {\n  SUCCESS,\n  ERROR,\n}\n","import { DmtBaseQueryOrder } from './dmt-base-order';\n\nexport class DmtBaseOrderingConverter {\n  static fromSingleSort<OrderableBy>(sort?: OrderableBy, sortDir?: string): DmtBaseQueryOrder<OrderableBy> {\n    if (sort && sortDir) {\n      return { order: [{ field: sort, desc: sortDir === 'desc' }] };\n    } else {\n      return {};\n    }\n  }\n}\n","import { ICursorPaginationEvent, IOffsetPaginationEvent } from '@sentinel/common/pagination';\nimport { CursorPaginationQuery, OffsetPaginationQuery } from './pagination-query';\n\nexport class CursorPaginationConverter {\n  static convert(pagination: ICursorPaginationEvent): CursorPaginationQuery {\n    return {\n      cursor: pagination.cursor ?? undefined,\n      limit: pagination.size,\n    };\n  }\n}\n\nexport class OffsetPaginationConverter {\n  static convert(pagination: IOffsetPaginationEvent): OffsetPaginationQuery {\n    return {\n      offset: pagination.page * pagination.size,\n      limit: pagination.size,\n    };\n  }\n}\n","import { CursorPaginatedResponse, OffsetPaginatedResponse } from './paginated-response';\nimport { QueryCursorPaginationData, QueryOffsetPaginationData } from './query-pagination-data';\n\nexport class QueryCursorPaginationDataResolver {\n  static resolve(cursorPaginatedResponse: CursorPaginatedResponse<unknown>): QueryCursorPaginationData {\n    return {\n      cursors: { prev: cursorPaginatedResponse.previous, next: cursorPaginatedResponse.next },\n      elementsCount: cursorPaginatedResponse?.data?.length ?? 0,\n      totalCount: cursorPaginatedResponse?.totalCount ?? 0,\n    };\n  }\n}\n\nexport class QueryOffsetPaginationDataResolver {\n  static resolve(offsetPaginatedResponse: OffsetPaginatedResponse<unknown>): QueryOffsetPaginationData {\n    return {\n      elementsCount: offsetPaginatedResponse?.data?.length ?? 0,\n      totalCount: offsetPaginatedResponse?.totalCount ?? 0,\n    };\n  }\n}\n","import { DefaultContext } from '@apollo/client/core/types';\nimport { HttpHeaders } from '@angular/common/http';\n\nconst IGNORE_ERROR_MESSAGE_ATTR = 'ignoreErrorMessage';\n\nexport function createApolloContextIgnoreErrorMessage(ignore: boolean): DefaultContext {\n  return { [IGNORE_ERROR_MESSAGE_ATTR]: ignore };\n}\n\nexport function retrieveApolloContextIgnoreErrorMessage(context: DefaultContext): boolean {\n  if (context[IGNORE_ERROR_MESSAGE_ATTR] !== undefined) {\n    return context[IGNORE_ERROR_MESSAGE_ATTR];\n  } else {\n    return false;\n  }\n}\n\nconst ERROR_TITLE_ATTR = 'errorTitle';\n\nexport function createApolloContextErrorTitle(title: string): DefaultContext {\n  return { [ERROR_TITLE_ATTR]: title };\n}\n\nexport function retrieveApolloContextErrorTitle(context: DefaultContext): string {\n  if (context[ERROR_TITLE_ATTR] !== undefined) {\n    return context[ERROR_TITLE_ATTR];\n  } else {\n    return 'Unknown operation';\n  }\n}\n\nexport const RETRYABLE_ATTR = 'retryable';\n\nexport function createApolloContextRetryable(value: boolean): DefaultContext {\n  return { [RETRYABLE_ATTR]: value };\n}\n\nexport function retrieveApolloContextRetryable(context: DefaultContext): boolean {\n  if (context[RETRYABLE_ATTR] !== undefined) {\n    return context[RETRYABLE_ATTR];\n  } else {\n    return false;\n  }\n}\n\nexport function wrapApolloContextForFileUpload(currContext: DefaultContext): DefaultContext {\n  currContext.useMultipart = true;\n  if (currContext.headers) {\n    currContext.headers = currContext.headers.append('Apollo-Require-Preflight', `true`);\n  } else {\n    currContext.headers = new HttpHeaders().set('Apollo-Require-Preflight', `true`);\n  }\n  return currContext;\n}\n","import { Observable, of } from 'rxjs';\nimport { FetchResult } from '@apollo/client/core';\nimport { ApolloResultType } from '../entity/apollo-result-type';\nimport { ApolloResult } from '../entity/apollo-result';\nimport { MutationResult } from 'apollo-angular/types';\nimport { GraphQLError } from 'graphql/index';\n\nexport class ApolloOperationResultResolver {\n  static resolve(fetchResult: FetchResult | MutationResult): ApolloResult {\n    return fetchResult.errors\n      ? new ApolloResult(ApolloResultType.ERROR, fetchResult.errors)\n      : new ApolloResult(ApolloResultType.SUCCESS);\n  }\n\n  static handleError(err: ReadonlyArray<GraphQLError>): Observable<ApolloResult> {\n    return of(new ApolloResult(ApolloResultType.ERROR, err));\n  }\n}\n","import {\n  CursorPagination,\n  ICursorPagination,\n  ICursorPaginationEvent,\n  IOffsetPagination,\n  IOffsetPaginationEvent,\n  OffsetPagination,\n} from '@sentinel/common/pagination';\nimport { QueryCursorPaginationData, QueryOffsetPaginationData } from './dmt/query-pagination-data';\n\nexport class CursorPaginationResolver {\n  static resolve(\n    paginationData: QueryCursorPaginationData,\n    paginationEvent: ICursorPaginationEvent,\n  ): ICursorPagination {\n    return new CursorPagination(\n      paginationEvent.cursor,\n      paginationData.elementsCount,\n      paginationEvent.size,\n      paginationData.totalCount,\n      paginationData.cursors.next ?? null,\n      paginationData.cursors.prev ?? null,\n    );\n  }\n}\n\nexport class OffsetPaginationResolver {\n  static resolve(\n    paginationData: QueryOffsetPaginationData,\n    paginationEvent: IOffsetPaginationEvent,\n  ): IOffsetPagination {\n    return new OffsetPagination(\n      paginationEvent.page,\n      paginationData.elementsCount,\n      paginationEvent.size,\n      paginationData.totalCount,\n      Math.floor(paginationData.totalCount / paginationEvent.size),\n    );\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}