{"version":3,"file":"sentinel-common-sort-services.mjs","sources":["../../../projects/sentinel-common/sort-services/src/order-token.ts","../../../projects/sentinel-common/sort-services/src/sort.service.ts","../../../projects/sentinel-common/sort-services/src/query-param-sort.service.ts","../../../projects/sentinel-common/sort-services/src/sentinel-common-sort-services.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { SortEvent } from './sort-event';\n\nexport const INIT_SORT_TOKEN = new InjectionToken<SortEvent>('INIT_ORDER_TOKEN');\n","import { Inject, Injectable, Optional } from '@angular/core';\nimport equal from 'fast-deep-equal/es6';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { distinctUntilChanged, shareReplay } from 'rxjs/operators';\nimport { INIT_SORT_TOKEN } from './order-token';\nimport { SortEvent } from './sort-event';\n\n@Injectable()\nexport class SortService {\n  readonly INIT_SORT: SortEvent;\n  protected sortSubject$: BehaviorSubject<SortEvent>;\n  sort$: Observable<SortEvent>;\n\n  constructor(@Optional() @Inject(INIT_SORT_TOKEN) protected readonly initSort?: SortEvent) {\n    this.INIT_SORT = initSort ? initSort : { sort: undefined, sortDir: undefined };\n    this.sortSubject$ = new BehaviorSubject<SortEvent>(this.INIT_SORT);\n\n    this.sort$ = this.sortSubject$.asObservable().pipe(\n      distinctUntilChanged((prev, curr) => equal(prev, curr)),\n      shareReplay({ refCount: true }),\n    );\n  }\n\n  get(): SortEvent {\n    return this.sortSubject$.getValue();\n  }\n\n  update(sort: SortEvent) {\n    this.sortSubject$.next({ ...sort });\n  }\n}\n","import { Inject, Injectable, Optional } from '@angular/core';\nimport { ActivatedRoute, ParamMap } from '@angular/router';\nimport equal from 'fast-deep-equal/es6';\nimport { from, Observable } from 'rxjs';\nimport { concatMap, distinctUntilChanged, map, shareReplay, take } from 'rxjs/operators';\nimport { INIT_SORT_TOKEN } from './order-token';\nimport { SortService } from './sort.service';\nimport { SortEvent } from './sort-event';\nimport { QueryParamsNavigationQueueService, toQueryParams } from '@sentinel/common/utils';\n\n@Injectable()\nexport class QueryParamSortService extends SortService {\n  constructor(\n    protected queryParamsQueueService: QueryParamsNavigationQueueService,\n    private activatedRoute: ActivatedRoute,\n    @Optional() @Inject(INIT_SORT_TOKEN) protected readonly initSort?: SortEvent,\n  ) {\n    super(initSort);\n    this.sort$ = this.createSortObservable();\n  }\n\n  protected updateQueryParams(sort: SortEvent): Observable<boolean> {\n    return from(this.queryParamsQueueService.enqueue(toQueryParams<SortEvent>(sort)));\n  }\n\n  private createSortObservable(): Observable<SortEvent> {\n    return this.fromRoute().pipe(\n      take(1),\n      concatMap(() => this.sortSubject$),\n      distinctUntilChanged((prev, curr) => equal(prev, curr)),\n      concatMap((sort) => this.updateQueryParams(sort).pipe(map(() => sort))),\n      shareReplay({ refCount: true }),\n    );\n  }\n\n  private fromRoute(): Observable<SortEvent> {\n    return this.activatedRoute.queryParamMap.pipe(\n      take(1),\n      map((paramMap) => this.sortFromParamMap(paramMap)),\n    );\n  }\n\n  private sortFromParamMap(paramMap: ParamMap): SortEvent {\n    const sort = paramMap.get('sort');\n    const sortDirStr = paramMap.get('sortDir');\n    if (sort !== null && sortDirStr !== null) {\n      const sortDir = sortDirStr === 'asc' ? 'asc' : 'desc';\n      return { sort, sortDir };\n    }\n    return this.INIT_SORT;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}