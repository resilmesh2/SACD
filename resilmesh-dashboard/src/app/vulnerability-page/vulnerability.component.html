<h1>Look for vulnerability in your network</h1>
<!-- Search bar -->
<div class="search-filter">
  <mat-form-field appearance="outline">
    <mat-label>Search vulnerability by CVE code</mat-label>
    <input matInput placeholder="" [(ngModel)]="cveSearch" />
  </mat-form-field>
  <button [disabled]="!cveSearch" mat-raised-button color="primary" (click)="searchVulnerability()">
    <mat-icon>search</mat-icon>
    Search
  </button>
</div>
<ng-container *ngIf="dataLoading">
  <mat-spinner></mat-spinner>
</ng-container>
<ng-container *ngIf="errorResponse">
  <p class="error">
    <strong>Error fetching data from GraphQL API.</strong><br /><span>Error message: {{ errorResponse }}</span>
  </p>
</ng-container>
<ng-container *ngIf="emptyResponse">
  <p class="no-data">
    No available data for <strong>{{ cveSearched }}</strong>
  </p>
</ng-container>
<ng-container *ngIf="dataLoaded && !dataLoading && !emptyResponse">
  <!-- Vulnerability info -->
  <div class="section">
    <strong>Vulnerability description</strong>
    <p>{{ cveDescription }}</p>
    <strong>Published</strong>
    <p>{{ cveDetails.published }}</p>
    <strong>Impact</strong>
    <p>{{ cveDetails.impact }}</p>
    <div class="cve-details">
      <div>
        <p>
          <strong>CVSS v3.1 Base score: </strong
          ><span [ngClass]="scoreClass(cveDetails.base_score_v31, 3)" class="score-text">{{
            cveDetails.base_score_v31
          }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 Confidentiality Impact: </strong
          ><span [ngClass]="scoreClass(cveDetails.confidentiality_impact_v31, 3)" class="score-text">{{
            cveDetails.confidentiality_impact_v31
          }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 Integrity Impact: </strong
          ><span [ngClass]="scoreClass(cveDetails.integrity_impact_v31, 3)" class="score-text">{{
            cveDetails.integrity_impact_v31
          }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 Availability Impact: </strong
          ><span [ngClass]="scoreClass(cveDetails.availability_impact_v31, 3)" class="score-text">{{
            cveDetails.availability_impact_v31
          }}</span>
        </p>
      </div>
      <div>
        <p>
          <strong>CVSS v3.1 Attack vector: </strong><span class="score-text">{{ cveDetails.attack_vector_v31 }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 Attack complexity: </strong><span class="score-text">{{ cveDetails.attack_complexity_v31 }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 Privileges required: </strong><span class="score-text">{{ cveDetails.privileges_required_v31 }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 User interaction: </strong><span class="score-text">{{ cveDetails.user_interaction_v31 }}</span>
        </p>
        <p>
          <strong>CVSS v3.1 Scope: </strong><span class="score-text">{{ cveDetails.scope_v31 }}</span>
        </p>
      </div>
    </div>
    <p class="show-more">
      <a target="_blank" [href]="'https://cve.mitre.org/cgi-bin/cvename.cgi?name=' + cveSearch">
        <button mat-raised-button color="link">Show more info on mitre.org</button>
      </a>
    </p>
  </div>

  <div class="section" style="min-height: 400px">
    <h3>Vulnerable hosts per subnet</h3>
    <ngx-charts-pie-chart
      #pieChart
      (select)="filterSubnet($event)"
      [labels]="true"
      [legend]="true"
      [results]="pieChartData"
      [animations]="false"
    ></ngx-charts-pie-chart>
  </div>
  <div class="section">
    <h3>List of vulnerable hosts</h3>
    <!-- Table with results -->
    <table mat-table [dataSource]="dataSource" matSort>
      <!-- IP Address Column -->
      <ng-container matColumnDef="ip">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>IP Address</th>
        <td mat-cell *matCellDef="let row">
          <a [routerLink]="['/network-vizualization', row.ip]"
            ><strong>{{ row.ip }}</strong></a
          >
        </td>
      </ng-container>

      <!-- Domain name Column -->
      <ng-container matColumnDef="domainName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Domain name</th>
        <td mat-cell *matCellDef="let row">{{ row.domainName }}</td>
      </ng-container>

      <!-- Subnet Column -->
      <ng-container matColumnDef="subnet">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Subnet</th>
        <td mat-cell *matCellDef="let row">{{ row.subnet }}</td>
      </ng-container>

      <!-- Software Column -->
      <ng-container matColumnDef="software">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Software</th>
        <td mat-cell *matCellDef="let row" [style.color]="row.color">{{ row.software }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No data matching the CVE code "{{ cveSearch }}"</td>
      </tr>
    </table>
    <mat-paginator [pageSize]="25" [pageSizeOptions]="[25, 50, 200, 500]"></mat-paginator>
  </div>
</ng-container>
